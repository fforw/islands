var App=function(e){function t(t){for(var r,o,s=t[0],l=t[1],u=t[2],c=0,d=[];c<s.length;c++)o=s[c],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&d.push(i[o][0]),i[o]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(f&&f(t);d.length;)d.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var l=n[s];0!==i[l]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={3:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var s=window.webpackJsonpApp=window.webpackJsonpApp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var f=l;return a.push([47,0]),n()}([,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Vector",{enumerable:!0,get:function(){return i.default}}),t.default=t.t_size=t.t_tile3=t.t_tile2=t.t_tile1=t.t_tile0=t.t_isEdge=t.t_n3=t.t_n2=t.t_n1=t.t_n0=t.g_size=t.g_edge5=t.g_edge4=t.g_edge3=t.g_edge2=t.g_edge1=t.g_edge0=t.g_count=t.g_isEdge=t.g_y=t.g_x=t.f_size=t.f_outmostEdge=t.f_count=t.f_y3=t.f_x3=t.f_y2=t.f_x2=t.f_y1=t.f_x1=t.f_y0=t.f_x0=void 0;var r=a(n(27)),i=a(n(21));function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||c(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}t.f_x0=0;t.f_y0=1;t.f_x1=2;t.f_y1=3;t.f_x2=4;t.f_y2=5;t.f_x3=6;t.f_y3=7;t.f_count=8;t.f_outmostEdge=9;t.f_size=10;t.g_x=0;t.g_y=1;t.g_isEdge=2;t.g_count=3;t.g_edge0=4;t.g_edge1=5;t.g_edge2=6;t.g_edge3=7;t.g_edge4=8;t.g_edge5=9;t.g_size=10;t.t_n0=0;t.t_n1=1;t.t_n2=2;t.t_n3=3;t.t_isEdge=4;t.t_tile0=5;t.t_tile1=6;t.t_tile2=7;t.t_tile3=8;t.t_size=9;var h=2*Math.PI/6;var v={width:0,height:0,numberOfRings:5,removeEdges:50,animatedEasing:!0,renderFirstPassEdges:!1,debug:!1,weightFunction:function(e,t,n,r){var i=n-e,a=r-t;return Math.sqrt(i*i+a*a)},edgeLength:80,maxIterations:100,animating:!0,minTension:2};function m(e,t,n,r,i,a,o){for(var s=0;s<e.length;s+=10)if(s!==a){var l=e[s+8];if(e[s+0]===r&&e[s+1]===i&&e[s+2]===t&&e[s+3]===n)return o.index=s,void(o.edge=0);if(e[s+2]===r&&e[s+3]===i&&e[s+4]===t&&e[s+5]===n)return o.index=s,void(o.edge=1);if(3===l){if(e[s+4]===r&&e[s+5]===i&&e[s+0]===t&&e[s+1]===n)return o.index=s,void(o.edge=2)}else{if(e[s+4]===r&&e[s+5]===i&&e[s+6]===t&&e[s+7]===n)return o.index=s,void(o.edge=2);if(e[s+6]===r&&e[s+7]===i&&e[s+0]===t&&e[s+1]===n)return o.index=s,void(o.edge=3)}}o.index=-1}var g={index:-1,edge:0};function p(e,t){var n=e.firstPassNumEdges*e.removeEdges/100|0,r=function(e,t){for(var n=3*e.numFaces,r=new Int32Array(n),i=0,a=0;a<e.firstPassLen;a+=10){if(!(t[a+9]>=0)){var o=a<<2;r[i++]=o,r[i++]=o+1,r[i++]=o+2}}for(var s=0;s<i-2;s++){var l=s+(Math.random()*i-s-1|0),u=r[s];r[s]=r[l],r[l]=u}return r.slice(0,i)}(e,t);e.debug&&console.log("Shuffled stack",f(r.slice()));for(var i=0,a=function(e){for(var t=i;t<r.length;t++)r[t]>>>2===e&&(r[t]=-1)},o=0,s=0;s<n;s++){var l=void 0;do{if(i===r.length)return void(e.debug&&e.debug&&console.log("Ran out of removal candidates after successfully removing",o,"out of",n));l=r[i++]}while(-1===l);var u=l>>2,c=3&l;if(m(t,t[u+2*c],t[u+2*c+1],2===c?t[u+0]:t[u+2*(c+1)],2===c?t[u+1]:t[u+2*(c+1)+1],u,g),g.index>=0&&3===t[g.index+8]){var d=g.index,h=g.edge,v=0===c?t[u+4]:t[u+2*(c-1)],p=0===c?t[u+5]:t[u+2*(c-1)+1],y=t[d+9]>=0;switch(t[d+8]=4,h){case 2:t[d+6]=v,t[d+7]=p;break;case 1:t[d+6]=t[d+4],t[d+7]=t[d+5],t[d+4]=v,t[d+5]=p;break;case 0:t[d+6]=t[d+4],t[d+7]=t[d+5],t[d+4]=t[d+2],t[d+5]=t[d+3],t[d+2]=v,t[d+3]=p,y&&(t[d+9]=2)}a(d),t[u+8]=0,o++}a(u)}return e.debug&&console.log("Successfully removed",o,"out of",n),o}function y(e,t){for(var n=e.firstPassLen,r=function(e,t){for(var n=0,r=0,i=0;i<e.firstPassLen;i+=10){var a=t[i+8];3===a?n++:4===a&&r++}return 9*r+7*n}(e,t),i=new Float64Array(10*r),a=new Int32Array(9*(r/2|0)),o=0,s=0,l=function(e,t,n){e|=0,t|=0;for(var r=0;r<o;r+=10)if(Math.abs(i[r]-e)<4&&Math.abs(i[r+1]-t)<4)return n&&!i[r+2]&&(i[r+2]=1),r;var a=o;return i[o+0]=e,i[o+1]=t,i[o+2]=n?1:0,i[o+3]=0,o+=10,a},u=function(e,t,n,r){a[s+0]=e,a[s+1]=t,a[s+2]=n,a[s+3]=r,s+=9},f=function(e,t){for(var n=i[e+3],r=!1,a=0;a<n;a++){if(i[e+4+a]===t){r=!0;break}}if(!r){if(n>=6)throw new Error("At most 6 edges per node");i[e+4+n++]=t,i[e+3]=n}},c=function(e,t){f(e,t),f(t,e)},d=0;d<n;d+=10){var h=t[d+8],v=t[d+0],m=t[d+1],g=t[d+2],p=t[d+3],y=t[d+4],b=t[d+5],_=t[d+9],w=1===_,x=2===_;if(3===h){var O=(v+g)/2,j=(m+p)/2,P=(g+y)/2,M=(p+b)/2,A=(y+v)/2,S=(b+m)/2,z=(v+g+y)/3,k=(m+p+b)/3,E=l(v,m),T=l(O,j),C=l(g,p,w),I=l(P,M,w),F=l(y,b,w),L=l(A,S),D=l(z,k);c(E,T),c(T,D),c(D,L),c(L,E),c(T,C),c(C,I),c(I,D),c(D,T),c(L,D),c(D,I),c(I,F),c(F,L),u(E,T,D,L),u(T,C,I,D),u(L,D,I,F)}else if(4===h){var R=t[d+6],U=t[d+7],N=(v+g)/2,W=(m+p)/2,X=(g+y)/2,H=(p+b)/2,Z=(y+R)/2,B=(b+U)/2,q=(R+v)/2,G=(U+m)/2,Y=(v+g+y+R)/4,K=(m+p+b+U)/4,$=l(v,m),J=l(N,W),V=l(g,p,w),Q=l(X,H,w),ee=l(y,b,w||x),te=l(Z,B,x),ne=l(R,U,x),re=l(q,G),ie=l(Y,K);c($,J),c(J,V),c(V,Q),c(Q,ee),c(ee,te),c(te,ne),c(ne,re),c(re,$),c(ie,Q),c(ie,te),c(ie,re),c(ie,J),u($,J,ie,re),u(J,V,Q,ie),u(ie,Q,ee,te),u(re,ie,te,ne)}}console.log("TILES: buffer = ",a.length,", used = "+s);var ae=a.slice(0,s);return function(e,t){for(var n=t.length,r=0;r<n;r+=9){for(var i=0,a=0;a<4;a++){for(var o=t[r+0+a],s=3===a?t[r+0]:t[r+0+a+1],l=-1,u=0;u<t.length;u+=9)if(u!==r){var f=t[u+0],c=t[u+1],d=t[u+2],h=t[u+3];if(c===o&&f===s||d===o&&c===s||h===o&&d===s||f===o&&h===s){l=u,i++;break}}t[r+5+a]=l}t[r+4]=4===i?0:1}e.debug&&console.log("TILE GRAPH",t)}(e,ae),[i.slice(0,o),ae]}function b(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=t.length,i=0;i<n;i++){for(var a=0,o=0;o<r;o+=10)if(!t[o+2]){for(var s=t[o+0],l=t[o+1],u=t[o+3],f=0,c=0,d=0,h=0;h<u;h++){var v=t[o+4+h],m=t[v],g=t[v+1],p=e.weightFunction(s,l,m,g);f+=m*p,c+=g*p,d+=p}var y=f/d,b=c/d,_=y-s,w=b-l;t[o+0]=y,t[o+1]=b,a+=_*_+w*w}if(a<e.minTension)return e.debug&&console.log("Reached minimal tension",e.minTension,"after",e.relaxCount,"iterations"),!0;e.relaxCount++}return e.animatedEasing||e.debug&&console.log("Stopping after max iterations = "+e.maxIterations),!1}var _=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.render=function(e){var t=n.config,r=n.graph,i=n.faces;e.save();var a=t.width/2,o=t.height/2;e.translate(a,o);r.length;if(e.fillStyle="#000",e.fillRect(-a,-o,t.width,t.height),t.renderFirstPassEdges){e.strokeStyle="#f00",e.lineWidth=1;for(var s=0;s<t.firstPassLen;s+=10){var l=i[s+8];if(l>=3){e.beginPath(),e.moveTo(i[s+0],i[s+1]);for(var u=1;u<l;u++)e.lineTo(i[s+2*u],i[s+2*u+1]);e.closePath(),e.stroke();var f=i[s+9];f>=0&&(e.strokeStyle="#fe0",e.beginPath(),e.moveTo(i[s+2*f],i[s+2*f+1]),f===l-1?e.lineTo(i[s+0],i[s+1]):e.lineTo(i[s+2*(f+1)],i[s+2*(f+1)+1]),e.stroke(),e.strokeStyle="#f00")}}}e.restore(),t.animating&&b(t,r)&&(t.animating=!1)};var a,s,u=l(l({},v),t);(a=u).numFaces=6*((s=a.numberOfRings)+1)*(s+1),a.firstPassLen=10*a.numFaces,a.firstPassNumEdges=3*a.numFaces,a.edgeLength=Math.min(a.width,a.height)/(2*a.numberOfRings+2)|0,a.animating=a.animatedEasing,a.relaxCount=0,this.config=u;var f=function(e){var t=e.numberOfRings,n=[new i.default(Math.cos(0)*e.edgeLength,Math.sin(0)*e.edgeLength),new i.default(Math.cos(h)*e.edgeLength,Math.sin(h)*e.edgeLength),new i.default(Math.cos(2*h)*e.edgeLength,Math.sin(2*h)*e.edgeLength),new i.default(Math.cos(3*h)*e.edgeLength,Math.sin(3*h)*e.edgeLength),new i.default(Math.cos(4*h)*e.edgeLength,Math.sin(4*h)*e.edgeLength),new i.default(Math.cos(5*h)*e.edgeLength,Math.sin(5*h)*e.edgeLength)],r=new Float64Array(e.firstPassLen),a=0,o=0,s=1;do{for(var l=0;l<6;l++)for(var u=n[l],f=n[(l+1)%6],c=n[(l+2)%6],d=u.copy().scale(o),v=0;v<s;v++)if(1&v)r[a+0]=0|d.x,r[a+1]=0|d.y,r[a+2]=d.x+f.x|0,r[a+3]=d.y+f.y|0,r[a+4]=d.x+c.x|0,r[a+5]=d.y+c.y|0,r[a+8]=3,r[a+9]=-1,a+=10,d.add(c);else{var m=o===t;r[a+0]=0|d.x,r[a+1]=0|d.y,r[a+2]=d.x+u.x|0,r[a+3]=d.y+u.y|0,r[a+4]=d.x+f.x|0,r[a+5]=d.y+f.y|0,r[a+8]=3,r[a+9]=m?1:-1,a+=10}s+=2}while(o++<t);return r}(u);u.renderFirstPassEdges&&(this.faces="merged"!==u.renderFirstPassEdges?f.slice():f);var c=u.debug&&(0,r.default)();p(u,f),u.debug&&console.log("Edge removal in ",(0,r.default)()-c,"ms");var d=o(y(u,f),2),m=d[0],g=d[1];this.tiles=g,u.animating||b(u,m,u.maxIterations),this.graph=m};t.default=_},function(e,t,n){"use strict";var r,i;function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"l",(function(){return o})),n.d(t,"h",(function(){return s})),n.d(t,"d",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"i",(function(){return f})),n.d(t,"e",(function(){return c})),n.d(t,"b",(function(){return d})),n.d(t,"k",(function(){return h})),n.d(t,"f",(function(){return v})),n.d(t,"a",(function(){return m})),n.d(t,"j",(function(){return g})),n.d(t,"g",(function(){return p}));var o=0,s=1,l=2,u=3,f=4,c=5,d=6,h=8,v=["Water","Sand","Grass","Forest","Stone","Ice","Dirt","Packed_Ice"],m=[null,"case-1","case-2","case-3","case-4","case-5-1","case-6","case-7","case-8","case-9","case-10-1","case-11","case-12","case-13","case-14","case-15","case-m1","case-m2","case-m3","case-m4","case-5-2","case-10-2"],g=(a(r={},o,[0,.4,.8]),a(r,s,[.8,.8,0]),a(r,l,[0,.7,0]),a(r,d,[.5,.3,.1]),a(r,u,[.2,.5,.3]),a(r,f,[.5,.5,.5]),a(r,c,[1,1,1]),a(r,7,[1,1,1]),a(r,h,[1,0,1]),a(i={},o,0),a(i,s,1),a(i,l,1),a(i,d,1),a(i,u,1),a(i,f,.4),a(i,c,.9),a(i,7,.8),a(i,h,0),2*Math.PI),p=(1+Math.sqrt(5))/2},,function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return l}));var r=n(0),i=n(2);n(9);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=1,s=i.b,l=function(){function e(t,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=n,this.size=t,this.data=new Float64Array(t*t*s);var l=new Float64Array(2*s);this.offsets=l;var u=-t*o/2,f=-t*o/2,c=0,d=t*o,h=0,v=1,m=v,g=!1,p=new r.q;p.name="MaterialGrid";for(var y=0;y<s;y++){if(l[h++]=u,l[h++]=f,n){var b=new r.X(o*t,o*t,1,1),_=a[y].clone();_.side=r.l;var w=new r.K(b,_);w.name="M"+y,w.position.set(u,f,0),p.add(w)}if(u+=c,f+=d,0==--m){var x=c;c=-d,d=x,g&&v++,g=!g,m=v}}p.rotation.x=i.j/4,n&&(this.group=p,n.add(p))}var t,n,l;return t=e,(n=[{key:"setTile",value:function(e,t,n,r,i){for(var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=this.size,s=r.sizeX,l=r.sizeZ,c=2*i,d=t+u[c]*(s-1),h=n+u[c+1]*(l-1),v=f[c],m=f[c+1],g=e*o*o,p=!a,y=!p&&new Uint32Array(s*l),b=-v*s-m,_=-m*l+v,w=0,x=0;x<l;x++){for(var O=0;O<s;O++){var j=g+d+h*o,P=r.pattern[x*s+O];p?this.data[j]===P&&(this.data[j]=0):(this.data[j]!==P&&"function"==typeof a&&a(j),y[w++]=j,this.data[j]=P),d+=v,h+=m}d+=b,h+=_}return y}},{key:"clearTile",value:function(e){this.setTile(e.material,e.x,e.y,e.tile,e.rotation,null)}}])&&a(t.prototype,n),l&&a(t,l),e}(),u=[0,0,1,0,1,1,0,1],f=[1,0,0,1,-1,0,0,-1]},,function(e,t,n){"use strict";var r=new(n(13).a);t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,i){r.load(e,n,t,i)}))}},function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return d}));n(0);var r={cactus:{variants:["cactus_short","cactus_tall"],colors:["#0c0"]},flower:{variants:["flower_purpleA","flower_purpleB","flower_purpleC","flower_redA","flower_redB","flower_redC","flower_yellowA","flower_yellowB","flower_yellowC"],colors:["#ff0"]},stone_large:{variants:["stone_largeD","stone_largeE","stone_largeF"],colors:["#eee"]},stone_small:{variants:["stone_smallD"],colors:["#888"]},palm_tree:{variants:["tree_palmDetailedTall","tree_palmShort","tree_palmTall"],colors:["#8c0"]},pine:{variants:["tree_pineRoundD","tree_pineTallC_detailed","tree_pineTallD"],colors:["#480"]},tree_plateau:{variants:["tree_plateau"],colors:["#482"]},tree_tall_dark:{variants:["tree_tall_dark"],colors:["#360"]},tree_thin:{variants:["tree_thin"],colors:["#684"]},house:{variants:["House"],sizeX:3,sizeY:2,sizeZ:3,reachable:!0,colors:["#f00"],idCount:1,pattern:[0,0,0,0,-1,0,0,0,0]}},i=n(12);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e){return e[e.length-1].id+e[e.length-1].idCount}function u(){var e=document.createElement("canvas");e.width=f,e.height=c;var t=e.getContext("2d");t.lineWidth=4,t.strokeStyle="rgba(255,64,64,0.5)",t.fillStyle="#fff";var n=.5*f,r=.5*c,i=.3*Math.min(r,n);return t.beginPath(),t.moveTo(-i+n,-i+r),t.lineTo(i+n,i+r),t.moveTo(i+n,-i+r),t.lineTo(-i+n,i+r),t.rect(0,0,f,c),t.stroke(),t.fillText("None",4,c-4),e}var f=40,c=f/.75;function d(e){var t=[],n=0;for(var a in r)r.hasOwnProperty(a)&&function(){var i=r[a],s=i.variants,l=i.sizeX,u=void 0===l?1:l,f=i.sizeY,c=void 0===f?1:f,d=i.sizeZ,h=void 0===d?1:d;t[n]=o(o({id:-1,name:a},i),{},{variants:e?e.scene.children.filter((function(e){return s.indexOf(e.name)>=0})):s,pattern:i.pattern?i.pattern.slice():null,idCount:i.idCount||1,sizeX:u,sizeY:c,sizeZ:h,reachable:i.reachable||!1,thumbnail:null}),n++}();t.sort((function(e,t){return e.name===t.name?0:e.name<t.name?-1:1}));var s=1;if(t.forEach((function(e){var t=e.name,n=e.idCount,r=e.pattern,i=e.sizeX,a=e.sizeZ;if(e.id=s,s+=n,e.pattern){if(!r||!Array.isArray(r))throw new Error("Tile '"+t+"': tiles with idCount > 1 must define a pattern");var o=i*a;if(r.length!==o)throw new Error("Tile '"+t+"': Pattern must be "+i+" x "+a+" = "+o+" elements long: "+r);for(var l=0;l<r.length;l++)r[l]<0&&(r[l]=-r[l]-1+e.id)}else e.pattern=[e.id]})),e){var l=[],d=[];return t.forEach((function(e,t){l[t]=e.name,d[t]=e.variants[0]})),Object(i.a)(d,f,c,l).then((function(e){return e.forEach((function(e,n){return t[n].thumbnail=e})),t.unshift({id:0,name:"empty",variants:[],idCount:1,sizeX:1,sizeY:.1,sizeZ:1,thumbnail:u(),pattern:[0]}),t}))}return t.unshift({id:0,name:"empty",variants:[],idCount:1,sizeX:1,sizeY:.1,sizeZ:1,reachable:!1,colors:["#000"],thumbnail:null}),t}},function(e,t,n){},function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return l}));var r,i=n(4),a=n(16),o=(n(2),n(7));function s(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=r.name,a=r.id,o=r.idCount;if(t===a)return i;if(t>a&&t<a+o)return i+"-"+(t-a+1)}return isNaN(t),"ERR:"+t}function l(e,t,n,s){var l=Object(o.b)(n),u=l+31>>5;(!r||r.length<u)&&(r=new Uint32Array(u));var f=new i.b(t);Object(a.a)(e,n,f);for(var c=0,d=t-1,h=function(e,t,n,r){var i=r>>5,a=1<<r-(i<<5),o=t*v*u+n*u+i,s=e[o],l=s|a;s!==l&&(e[o]=l)},v=l+1,m=i.c*v,g=new Uint32Array(m),p=i.c*v*u,y=new Uint32Array(p),b=0;b<i.c;b++)for(var _=0;_<t;_++)for(var w=0;w<t;w++){var x=f.data[c];0!==x&&g[b*v+1+x]++;var O=0===_?0:f.data[c-t],j=w===d?0:f.data[c+1],P=_===d?0:f.data[c+t],M=0===w?0:f.data[c-1];h(y,b,x,O),h(y,b,x,j),h(y,b,x,P),h(y,b,x,M),c++}c=0;for(var A=0;A<i.c;A++){r.fill(0);for(var S=0,z=0;z<l;z++){var k=g[c+1+z];if(k>0||0===z){S+=k;var E=z>>5,T=1<<z-(E<<5);r[E]|=T}}var C=A*v*u+l*u;if(0===S)g[c+1]=1,g[c]=1,r[0]|=1;else{var I=S*(s[A]/(1-s[A]));g[c+1]=I,g[c]=S+I}y.set(r,C),c+=v}return{weights:g,adjacencies:y}}},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0);function i(e,t,n,i){return new Promise((function(a){var o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.top="0px",o.style.left="-10000px";var s=new r.Bb({alpha:!0});s.setPixelRatio(window.devicePixelRatio),s.setSize(t,n),o.appendChild(s.domElement);var l=new r.ib,u=new r.V(55,t/n,.1,100),f=new r.k("#fff8d5",1.4);f.position.set(0,3,-1.5),l.add(f);for(var c,d=[],h=0;h<e.length;h++){c&&l.remove(c),c=e[h].clone();var v=new r.d;v.expandByObject(c);var m=Math.max(v.max.x-v.min.x,v.max.y-v.min.y),g=m<1.5,p=g?1.2*Math.pow(m,.9):1.5*m;u.up.set(0,1,0),u.position.set(0,v.max.y*(g?1.1:.9),-p),u.lookAt(new r.xb(0,(v.max.y+v.min.y)/(g?2:4),0)),u.updateProjectionMatrix(),c.position.set(0,0,0),l.add(c),s.render(l,u);var y=document.createElement("canvas");y.width=t,y.height=n;var b=y.getContext("2d");b.drawImage(s.domElement,0,0),b.strokeStyle="rgba(255,255,255,0.4)",b.fillStyle="#fff",b.lineWidth=2,b.beginPath(),b.rect(0,0,t,n),b.stroke();var _=i?i[h]:c.name;b.fillText(_,4,n-4),d.push(y)}a(d),l.dispose(),s.dispose(),document.body.removeChild(o)}))}},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(4),i=(n(0),n(2));function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=0,s=function(){function e(t,n,r,i,a,s,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=void 0,this.tile=void 0,this.position=void 0,this.object=null,this.indexes=null,this.id=++o,this.scene=t,this.tile=n,this.position=r.clone(),this.rotation=i,this.material=a,this.x=s,this.y=l,t&&this.createObject()}var t,n,s;return t=e,(n=[{key:"createObject",value:function(){var e=this.tile,t=this.scene,n=this.position,a=this.rotation,o=e.variants;this.variant=Math.random()*o.length|0;var s=o[this.variant].clone();s.scale.set(r.a,r.a,r.a),s.position.copy(n),s.rotation.y=i.j*a/4,this.object=s,t.add(s)}},{key:"removeObject",value:function(){var e=this.scene,t=this.object;t&&(e.remove(t),this.object=null)}}])&&a(t.prototype,n),s&&a(t,s),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(15),i=n(0);function a(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.name===t)return r}return null}function o(e,t,n,o,s){for(var l=e.instances,u=new Set,f=0;f<l.length;f++){var c=l[f],d=a(t,c.name);if(d){var h=new r.a(s,d,new i.xb(c.position[0],c.position[1],c.position[2]),4*Math.random()|0,c.material,c.x,c.y);h.variant=Math.random()*d.variants.length|0,h.indexes=n.setTile(h.material,h.x,h.y,h.tile,h.rotation,!0),o&&o.add(h)}else u.add(c.name)}u.size>0&&console.log("Could not find some tiles: ",u)}},function(e){e.exports=JSON.parse('{"version":1,"timestamp":"2020-06-15T19:30:37.781Z","instances":[{"name":"stone_small","position":[-1.5,0,3.5],"material":1,"x":10,"y":3},{"name":"stone_small","position":[-18.5,0,-18.5],"material":4,"x":5,"y":5},{"name":"stone_small","position":[-18.5,0,-17.5],"material":4,"x":5,"y":6},{"name":"stone_large","position":[-20.5,0,-19.5],"material":4,"x":3,"y":4},{"name":"stone_large","position":[-20.5,0,-18.5],"material":4,"x":3,"y":5},{"name":"tree_thin","position":[-18.5,0,-7.5],"material":3,"x":5,"y":4},{"name":"tree_thin","position":[-18.5,0,-6.5],"material":3,"x":5,"y":5},{"name":"tree_tall_dark","position":[-19.5,0,-7.5],"material":3,"x":4,"y":4},{"name":"tree_tall_dark","position":[-19.5,0,-6.5],"material":3,"x":4,"y":5},{"name":"pine","position":[-18.5,0,-5.5],"material":3,"x":5,"y":6},{"name":"pine","position":[-19.5,0,-5.5],"material":3,"x":4,"y":6},{"name":"tree_plateau","position":[-19.5,0,-8.5],"material":3,"x":4,"y":3},{"name":"tree_plateau","position":[-18.5,0,-8.5],"material":3,"x":5,"y":3},{"name":"tree_plateau","position":[-18.5,0,-4.5],"material":3,"x":5,"y":7},{"name":"tree_plateau","position":[-19.5,0,-4.5],"material":3,"x":4,"y":7},{"name":"tree_plateau","position":[-20.5,0,5.5],"material":2,"x":3,"y":5},{"name":"tree_thin","position":[-20.5,0,1.5],"material":2,"x":3,"y":1},{"name":"stone_large","position":[-21.5,0,8.5],"material":2,"x":2,"y":8},{"name":"pine","position":[-19.5,0,-15.5],"material":4,"x":4,"y":8},{"name":"flower","position":[-20.5,0,-5.5],"material":3,"x":3,"y":6},{"name":"flower","position":[-19.5,0,-9.5],"material":3,"x":4,"y":2},{"name":"flower","position":[-17.5,0,-7.5],"material":3,"x":6,"y":4},{"name":"stone_small","position":[-20.5,0,-4.5],"material":3,"x":3,"y":7},{"name":"stone_small","position":[-20.5,0,-6.5],"material":3,"x":3,"y":5},{"name":"stone_small","position":[-20.5,0,-8.5],"material":3,"x":3,"y":3},{"name":"stone_small","position":[-17.5,0,-6.5],"material":3,"x":6,"y":5},{"name":"stone_small","position":[-17.5,0,-5.5],"material":3,"x":6,"y":6},{"name":"tree_tall_dark","position":[-23.5,0,-10.5],"material":3,"x":0,"y":1},{"name":"tree_thin","position":[-23.5,0,-8.5],"material":3,"x":0,"y":3},{"name":"tree_plateau","position":[-23.5,0,-6.5],"material":3,"x":0,"y":5},{"name":"pine","position":[-23.5,0,-4.5],"material":3,"x":0,"y":7},{"name":"house","position":[-20.5,0,3.5],"material":2,"x":2,"y":2},{"name":"stone_small","position":[-22.5,0,3.5],"material":2,"x":1,"y":3},{"name":"pine","position":[-21.5,0,-2.5],"material":3,"x":2,"y":9},{"name":"pine","position":[-20.5,0,-2.5],"material":3,"x":3,"y":9},{"name":"flower","position":[-17.5,0,6.5],"material":2,"x":6,"y":6},{"name":"flower","position":[-17.5,0,5.5],"material":2,"x":6,"y":5},{"name":"flower","position":[-18.5,0,10.5],"material":2,"x":5,"y":10},{"name":"flower","position":[-18.5,0,9.5],"material":2,"x":5,"y":9},{"name":"cactus","position":[-11.5,0,4.5],"material":1,"x":0,"y":4},{"name":"palm_tree","position":[-7.5,0,5.5],"material":1,"x":4,"y":5},{"name":"tree_thin","position":[-13.5,0,8.5],"material":2,"x":10,"y":8},{"name":"tree_plateau","position":[-15.5,0,10.5],"material":2,"x":8,"y":10},{"name":"stone_small","position":[-14.5,0,5.5],"material":2,"x":9,"y":5},{"name":"flower","position":[-23.5,0,6.5],"material":2,"x":0,"y":6},{"name":"flower","position":[-23.5,0,7.5],"material":2,"x":0,"y":7},{"name":"flower","position":[-21.5,0,10.5],"material":2,"x":2,"y":10},{"name":"flower","position":[-22.5,0,10.5],"material":2,"x":1,"y":10},{"name":"palm_tree","position":[-3.5,0,8.5],"material":1,"x":8,"y":8},{"name":"palm_tree","position":[-7.5,0,9.5],"material":1,"x":4,"y":9},{"name":"flower","position":[-18.5,0,-3.5],"material":3,"x":5,"y":8}]}')},,,function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=.05,r=n*n,i=t?.4:.6,a=t?.75:.5;if(e<n)return r-(e=n-e)*e;if(e<i){var o=i-n;return r+(e-=n)*e*(a-r)/(o*o)}var s=1-i;return 1-(e=1-e)*e*e*(1-a)/(s*s*s)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=Math.sqrt,a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=n}var t,n,a;return t=e,(n=[{key:"copy",value:function(){return new e(this.x,this.y)}},{key:"add",value:function(e,t){return"number"==typeof e?(this.x+=e,this.y+=t):(this.x+=e.x,this.y+=e.y),this}},{key:"subtract",value:function(e,t){return"number"==typeof e?(this.x-=e,this.y-=t):(this.x-=e.x,this.y-=e.y),this}},{key:"scale",value:function(e){return this.x*=e,this.y*=e,this}},{key:"length",value:function(){var e=this.x,t=this.y;return i(e*e+t*t)}},{key:"norm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.scale(e/this.length())}},{key:"rotateClockwise",value:function(){var e=this.x,t=this.y;return this.x=t,this.y=-e,this}},{key:"rotateCounterClockwise",value:function(){var e=this.x,t=this.y;return this.x=-t,this.y=e,this}},{key:"set",value:function(e,t){"number"==typeof e?(this.x=e,this.y=t):(this.x=e.x,this.y=e.y)}}])&&r(t.prototype,n),a&&r(t,a),e}();t.default=a},function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.type;if("Group"===n){console.log(t+"GROUP",e.name);for(var i=t+"    ",a=e.children,o=0;o<a.length;o++)r(a[o],i)}else"Mesh"===n&&console.log(t+"MESH",e.name)}n.d(t,"a",(function(){return r}))},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"td_cx",(function(){return V})),n.d(t,"td_cy",(function(){return Q})),n.d(t,"td_walkable",(function(){return ee})),n.d(t,"td_cut0",(function(){return te})),n.d(t,"td_cut1",(function(){return ne})),n.d(t,"td_cut2",(function(){return re})),n.d(t,"td_cut3",(function(){return ie})),n.d(t,"td_tileId",(function(){return ae})),n.d(t,"td_entropy",(function(){return oe})),n.d(t,"td_collapsed",(function(){return se})),n.d(t,"td_ground",(function(){return le})),n.d(t,"td_bitmask",(function(){return ue})),n.d(t,"td_size",(function(){return fe})),n.d(t,"h_height",(function(){return me})),n.d(t,"h_ground",(function(){return ge})),n.d(t,"h_cuts",(function(){return pe})),n.d(t,"h_size",(function(){return ye}));var r=n(11),i=n.n(r),a=n(30),o=n(31),s=n.n(o),l=(n(8),n(10)),u=n.n(l),f=n(0),c=n(1),d=n.n(c),h=n(6),v=(n(32),n(14)),m=n(19),g=new f.rb,p=n(20),y=n(2),b=n(7),_=n(9),w=n(22),x=n(4),O=n(17);function j(e){return function(e){if(Array.isArray(e))return P(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var M,A,S=[1,.95,.5,.2,.98,1,1,1];var z,k,E,T,C=new Uint8Array(x.c);function I(e,t,n,r,i,a){for(var o=i+1,s=0,l=0,u=0;u<r;u++)for(var f=e[t+ue+u],c=1,d=0;c;){if(f&c){var h=a*o+1+d;s+=n[h],l+=A[h]}c<<=1,d++}return Math.log2(s)-l/s}function F(e,t,n,r){var i=e.tiles,a=Object(b.b)(r),o=a+31>>5,s=a+1,l=c.t_size/fe,u=fe/c.t_size;if(!M){var f=M=Object(_.a)(O,12,r,S),d=f.weights,h=f.adjacencies;console.log("weights",j(d),"adjacencies",j(h)),A=function(e,t){for(var n=Object(b.b)(e),r=n+1,i=new Float64Array(t),a=0;a<x.c;a++)for(var o=a*r+1,s=0;s<n;s++){var l=t[o+s];l>0&&(i[o+s]=Math.log2(l)*l)}return i}(r,M.weights),k=function(e,t){for(var n=new Uint8Array(e),r=0;r<t.length;r++){var i=t[r],a=i.id,o=i.idCount;if(i.reachable)for(var s=0;s<o;s++)n[a+s]=1}return n}(a,r)}var v=M,m=v.weights,g=v.adjacencies;!function(e,t,n,r){var i=M,a=i.weights,o=i.adjacencies,s=ye/c.g_size,l=fe/c.t_size,u=Object(b.b)(r),f=u+31>>5,d=u+1;if(ue+f>fe)throw new Error("more td_bitmaskN values needed");z||(z=new Uint32Array(f));for(var h=C.length,v=0,m=0;m<e.length;m+=c.t_size){var g=e[m+c.t_n0]*s,p=e[m+c.t_n1]*s,_=e[m+c.t_n2]*s,w=e[m+c.t_n3]*s;C.fill(0),C[t[g+ge]]++,C[t[p+ge]]++,C[t[_+ge]]++,C[t[w+ge]]++;for(var x=0,O=-1,j=0;j<h;j++){C[j]>x&&(x=C[j],O=j)}if(n[v+le]=O,O===y.e||O===y.l)n[v+ae]=0,n[v+se]=1;else{for(var P=!1,A=0;A<4;A++){var S=e[m+c.t_tile0+A];if(S>=0)if(n[S*l+se]){P=!0;break}}for(var k=O*d*f,E=O*d*f+u*f,T=0;T<f;T++)n[v+ue+T]=P?o[k+T]:o[E+T];n[v+oe]=I(n,v,a,f,u,O)}v+=fe}}(i,t,n,r);var p,w,P,F=!1,L=i.length/c.t_size;(!E||E.length<L)&&(E=new Float64Array(L+1|0)),(!T||T.length<a)&&(T=new Uint32Array(2*a));do{p=0;for(var D=1/0,R=0;R<n.length;R+=fe)if(!n[R+se]){var U=n[R+oe];U<D?(D=U,E[0]=R,p=1):U===D&&(E[p++]=R)}if(D===1/0)return;var N=void 0,W=null,X=0,H=n[(N=1===p?E[0]:E[Math.random()*p|0])+le];w=0,P=0;for(var Z=0;Z<o;Z++)for(var B=n[N+ue+Z],q=1;q;){if(B&q&&(n[N+ee]||!k[X])){var G=m[H*s+1+X];T[w++]=G,T[w++]=X,P+=G}q<<=1,X++}if(2===w)W=T[1];else for(var Y=Math.random()*P|0,K=0;K<w;K+=2){var $=T[K],J=T[K+1];if((Y-=$)<=0){W=J;break}}n[N+ae]=W,n[N+se]=1,F=!0,L--;for(var V=N*l,Q=0;Q<4;Q++){var te=i[V+c.t_tile0+Q];if(!(te<0)){var ne=te*u;if(!n[ne+se]){for(var re=n[ne+le],ie=!0,ce=0;ce<4;ce++){var de=i[te+c.t_tile0+ce];if(!(de<0)){var he=de*u,ve=n[he+se],me=n[he+ae];if(ve&&-1!==me){var pe=me>>5,be=1<<me-(pe<<5);if(!(g[re*s+a+pe]&be))continue;for(var _e=0;_e<o;_e++){var we=g[re*s+me+_e];ie?n[he+ue+_e]=we:n[ne+ue+_e]&=we}ie=!1}}}for(var xe=!0,Oe=0;Oe<o;Oe++)if(n[ne+ue+Oe]){xe=!1;break}xe?(n[ne+ae]=0,n[ne+se]=1):n[ne+oe]=I(n,ne,m,o,a,re)}}}}while(F&&L>0)}var L=/^(#)?([0-9a-f]+)$/i;function D(e){var t;if("string"!=typeof e||!(t=L.exec(e)))return null;var n=t[2];return 3===n.length?{r:parseInt(n[0],16)/15,g:parseInt(n[1],16)/15,b:parseInt(n[2],16)/15}:6===n.length?{r:parseInt(n.substring(0,2),16)/255,g:parseInt(n.substring(2,4),16)/255,b:parseInt(n.substring(4,6),16)/255}:null}function R(e){var t=D(e);if(!t)throw new Error("Invalid color "+e);return t}function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||N(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){if(e){if("string"==typeof e)return W(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?W(e,t):void 0}}function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var X,H,Z,B,q,G,Y,K,$,J,V=0,Q=1,ee=2,te=3,ne=4,re=5,ie=6,ae=7,oe=8,se=9,le=10,ue=11,fe=12;var ce=10*Math.random();Math.random();function de(e,t){var n=Math.sqrt(e*e+t*t),r=Object(p.a)(1-n/750,0);return Math.max(0,(62.5+62.5*(.99*xe.noise2D(ce+.003*e,.003*t)+xe.noise2D(.07*t,.07*e)*(1-.99)+0))*r)}var he=new Float64Array(5);function ve(){for(var e=J,t=(e.graph,e.tiles),n=t.length,r=fe/c.t_size,i=[],a=new Set,o=0;o<n;o+=c.t_size){var s=o*r,l=t[o+c.t_tile0]*r,u=t[o+c.t_tile1]*r,f=t[o+c.t_tile2]*r,d=t[o+c.t_tile3]*r;he[0]=de(K[s],K[s+1]),he[1]=l>=0?de(K[l+V],K[l+Q]):-1,he[2]=u>=0?de(K[u+V],K[u+Q]):-1,he[3]=f>=0?de(K[f+V],K[f+Q]):-1,he[4]=d>=0?de(K[d+V],K[d+Q]):-1;var h=0;if(l>=0&&Math.abs(he[0]-he[1])>7&&(h|=1),u>=0&&Math.abs(he[0]-he[2])>7&&(h|=2),f>=0&&Math.abs(he[0]-he[3])>7&&(h|=4),d>=0&&Math.abs(he[0]-he[4])>7&&(h|=8),0!==h){for(var v=0;v<4;v++)if(h&1<<v){var m=v,g=3===v?0:v+1,p=t[o+c.t_n0+m]*Ee,b=t[o+c.t_n0+g]*Ee,_=he[0],w=t[o+c.t_n0+m],x=t[o+c.t_n0+g];a.add(w),a.add(x),K[s+te+m]=_,K[s+te+g]=_;var O=Math.random();O<.2?$[p+ge]=y.i:O<.4&&($[b+ge]=y.i);var j=t[o+c.t_tile0+v];t[o+c.t_tile0+v]=-1;for(var P=-1,M=0;M<4;M++)if(t[j+c.t_tile0+M]===o&&-1===K[j*r+te+M]){P=o;break}-1!==P&&i.push(0,o,j,m,g)}for(var A=0;A<4;A++)if(!(h&1<<A)){var S=3===A?0:A+1,z=h&1<<(0===A?3:A-1),k=h&1<<S,E=t[o+c.t_tile0+A];(z||k)&&(z&&k?i.push(0,o,E,A,S):z?i.push(2,o,E,A,S):i.push(1,o,E,A,S))}}}var T,C=new Set,I=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=N(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,a=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw i}}}}(a);try{for(I.s();!(T=I.n()).done;)for(var F=T.value,L=0;L<n;L+=c.t_size)for(var D=0;D<4;D++){if(t[L+c.t_n0+D]===F){var R=L*r;C.add(L),-1===K[R+te+D]&&(K[R+te+D]=de(K[R+V],K[R+Q]))}}}catch(e){I.e(e)}finally{I.f()}return console.log("Tiles cut:",C.size," of ",K.length/fe),{tileCuts:i,cutTiles:C}}var me=0,ge=1,pe=2,ye=3;function be(){Fe=u()();var e=J=new d.a({numberOfRings:15,width:1500,height:1500,minTension:10}),t=e.graph,n=(e.tiles,e.config,t.length),r=ye/c.g_size;$=new Float64Array(n*r);for(var i=0,a=0;a<n;a+=c.g_size)$[i+me]=de(t[a+c.g_x],t[a+c.g_y]),$[i+ge]=y.k,i+=ye;K=new Float64Array(J.tiles.length/c.t_size*fe),function(){for(var e=J,t=e.graph,n=e.tiles,r=n.length,i=0,a=0;a<r;a+=c.t_size){var o=n[a+c.t_n0],s=n[a+c.t_n1],l=n[a+c.t_n2],u=n[a+c.t_n3];K[i+V]=(t[o+c.g_x]+t[s+c.g_x]+t[l+c.g_x]+t[u+c.g_x])/4,K[i+Q]=(t[o+c.g_y]+t[s+c.g_y]+t[l+c.g_y]+t[u+c.g_y])/4,K[i+ee]=0,K[i+te]=-1,K[i+ne]=-1,K[i+re]=-1,K[i+ie]=-1,i+=fe}}();var o=ve(),s=o.cutTiles,l=o.tileCuts;l,function(){for(var e=J.graph,t=e.length,n=0,r=0,i=0;i<t;i+=c.g_size){var a=e[r+c.g_x],o=$[n+me],s=e[r+c.g_y];if($[n+ge]===y.k)if(o<2)$[n+ge]=y.l;else if(o<6.5)$[n+ge]=y.h;else{var l=xe.noise2D(.005*a,.005*s);$[n+ge]=o<60?l<.2?y.d:y.c:l<.2?y.c:y.d}n+=ye,r+=c.g_size}}(),function(e){var t=function(){for(var e=J.tiles,t=e.length,n=0;n<t;n+=c.t_size)if(e[n+c.t_isEdge])return n;throw new Error("No edge!?")}();console.log("Starting to walk at #",t/c.t_size);var n=new Set;!function e(t,n,r){if(t>=0&&!n.has(t)){if(r.has(t))return;n.add(t);var i=J.tiles;K[t*_e+ee]=1,e(i[t+c.t_tile0],n,r),e(i[t+c.t_tile1],n,r),e(i[t+c.t_tile2],n,r),e(i[t+c.t_tile3],n,r)}}(t,n,e)}(s)}var _e=fe/c.t_size;var we=new a.a("TEST"),xe=new s.a((function(){return we.next()}));var Oe=R("#f0f");var je,Pe,Me=1e3,Ae=.1,Se=.1;function ze(){if(Pe){var e=Math.PI*(Ae-.5),t=2*Math.PI*(Se-.5);q.position.x=Me*Math.cos(t),q.position.y=Me*Math.sin(t)*Math.sin(e),q.position.z=Me*Math.sin(t)*Math.cos(e),Pe.material.uniforms.sunPosition.value=q.position.copy(q.position),Y&&Y.material.uniforms.sunDirection.value.copy(q.position).normalize(),je.update(B,Pe)}}function ke(){be(),X=document.getElementById("container"),(B=new f.Bb).setPixelRatio(window.devicePixelRatio),B.setSize(window.innerWidth,window.innerHeight),B.outputEncoding=f.Cb,X.appendChild(B.domElement),Z=new f.ib,(H=new f.V(55,window.innerWidth/window.innerHeight,1,2e4)).position.set(250,250,1e3),q=new f.k("#fff8d5",.8),Z.add(q),je=new f.j(.2,1,512),Z.background=je.renderTarget;var e=new f.X(3e4,3e4),t=new f.N({side:f.p,color:"#00232a",envMap:je.renderTarget.texture,roughness:.2});new f.K(e,t).rotation.x=-Math.PI/2,Pe=new v.a,je.renderTarget.texture,ze(),(G=new m.a(H,B.domElement)).maxPolarAngle=Math.PI,G.target.set(0,0,0),G.minDistance=0,G.maxDistance=1500,G.enableDamping=!0,G.dampingFactor=.02,G.update(),window.addEventListener("resize",Te,!1);var n=Object(b.a)(null);Le=u()(),F(J,$,K,n),De=u()(),function(e){var t=new f.g;t.name="Landscape-Debug";var n=[],r=[],i=[],a=[],o=J,s=o.graph,l=o.tiles,u=l.length;console.log("Height map for ",u/c.t_size," tiles");for(var d=function(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=r.id,a=r.idCount,o=r.colors;if(t>=i&&t<i+a)return R(o[t-i])}return console.log("No color for ",Object(_.b)(e,t)),Oe},h=0,v=0;v<u;v+=c.t_size){var m=l[v+c.t_n0],g=l[v+c.t_n1],p=l[v+c.t_n2],b=l[v+c.t_n3],w=m*Ee,x=g*Ee,O=p*Ee,j=b*Ee,P=s[m+c.g_x],M=-1===K[h+te]?$[w+me]:K[h+te],A=s[m+c.g_y],S=s[g+c.g_x],z=-1===K[h+ne]?$[x+me]:K[h+ne],k=s[g+c.g_y],E=s[p+c.g_x],T=-1===K[h+re]?$[O+me]:K[h+re],C=s[p+c.g_y],I=s[b+c.g_x],F=-1===K[h+ie]?$[j+me]:K[h+ie],L=s[b+c.g_y],D=P-S,U=M-z,N=A-k,W=E-S,X=T-z,H=C-k,B=I-S,q=F-z,G=L-k,Y=(U*H-N*X+(U*G-N*q))/2,V=(N*W-D*H+(N*B-D*G))/2,Q=(D*X-U*W+(D*q-U*B))/2,ee=1/Math.sqrt(Y*Y+V*V+Q*Q);Y*=ee,V*=ee,Q*=ee;var oe=$[w+ge],se=$[x+ge],le=$[O+ge],ue=$[j+ge];if(oe!==y.l||se!==y.l||le!==y.l||ue!==y.l){n.push(P,M,A),n.push(I,F,L),n.push(S,z,k),n.push(S,z,k),n.push(I,F,L),n.push(E,T,C),r.push(Y,V,Q),r.push(Y,V,Q),r.push(Y,V,Q),r.push(Y,V,Q),r.push(Y,V,Q),r.push(Y,V,Q);var ce=d(e,K[h+ae]);i.push(ce.r,ce.g,ce.b),i.push(ce.r,ce.g,ce.b),i.push(ce.r,ce.g,ce.b),i.push(ce.r,ce.g,ce.b),i.push(ce.r,ce.g,ce.b),i.push(ce.r,ce.g,ce.b)}h+=fe}t.setAttribute("position",new f.o(n,3)),t.setAttribute("normal",new f.o(r,3)),t.setAttribute("color",new f.o(i,3));var de=new f.N({vertexColors:!0,side:f.l,roughness:.5}),he=new f.K(t,de);if(he.position.set(0,-2,0),Z.add(he),a.length>0){var ve=new f.g;ve.setAttribute("position",new f.f(new Float32Array(a),3,!1)),ve.setAttribute("normal",new f.f(new Float32Array([]),3,!1));var pe=new f.K(ve,new f.L({color:new f.i("#f0f"),depthTest:!1}));Z.add(pe)}}(n)}new f.T;var Ee=ye/c.g_size;new f.xb,new f.xb,new f.xb,new f.xb,new f.xb,new f.xb,new f.xb,new f.xb,new f.xb;function Te(){H.aspect=window.innerWidth/window.innerHeight,H.updateProjectionMatrix(),B.setSize(window.innerWidth,window.innerHeight)}function Ce(){!function(){var e=1e-4*performance.now();Y&&(Y.position.y=1.9+.4*Math.sin(e),Y.material.uniforms.time.value+=1/60);B.render(Z,H);!1}(),ze(),G.update(),i()(Ce)}var Ie,Fe,Le,De;Promise.all([Object(h.a)("assets/tiles.glb"),Object(h.a)("assets/ground.glb"),Object(h.a)("assets/ms.glb"),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,r){g.load(e,n,t,r)}))}("assets/waternormals.jpg")]).then((function(e){var t=U(e,4),n=(t[0],t[1]),r=t[2],i=t[3];Ie=u()(),Object(w.a)(n.scene,"tiles: "),y.f.map((function(e){return n.scene.children.find((function(t){return t.name===e})).material})),function(e){for(var t=e.children,n=new Array(y.a.length),r=0;r<t.length;r++){var i=t[r],a=y.a.indexOf(i.name);a>=0&&(n[a]=i.geometry)}return n}(r.scene),i.wrapS=i.wrapT=f.hb,i,ke();var a=u()();console.log("Init: ",Fe-Ie,"ms"),console.log("Organic Quads: ",De-Fe,"ms"),console.log("WFC: ",De-Le,"ms"),console.log("geo: ",a-De,"ms"),console.log("Total: ",a-Ie,"ms"),Ce()}))}]).default;
//# sourceMappingURL=bundle-main-add539d8a19fa706543b.js.map