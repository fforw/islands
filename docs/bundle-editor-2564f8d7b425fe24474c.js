var App=function(e){function t(t){for(var i,o,l=t[0],s=t[1],c=t[2],f=0,m=[];f<l.length;f++)o=l[f],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&m.push(a[o][0]),a[o]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);for(u&&u(t);m.length;)m.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,l=1;l<n.length;l++){var s=n[l];0!==a[s]&&(i=!1)}i&&(r.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},a={1:0},r=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var l=window.webpackJsonpApp=window.webpackJsonpApp||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;return r.push([40,0]),n()}({16:function(e){e.exports=JSON.parse('{"version":1,"timestamp":"2020-06-13T13:31:32.504Z","instances":[{"name":"stone_small","position":[-1.5,0,3.5],"rotation":0,"material":1,"x":10,"y":3},{"name":"stone_small","position":[-18.5,0,-18.5],"rotation":0,"material":4,"x":5,"y":5},{"name":"stone_small","position":[-18.5,0,-17.5],"rotation":0,"material":4,"x":5,"y":6},{"name":"stone_large","position":[-20.5,0,-19.5],"rotation":0,"material":4,"x":3,"y":4},{"name":"stone_large","position":[-20.5,0,-18.5],"rotation":0,"material":4,"x":3,"y":5},{"name":"cactus","position":[-3.5,0,7.5],"rotation":0,"material":1,"x":8,"y":7},{"name":"tree_thin","position":[-18.5,0,-7.5],"rotation":0,"material":3,"x":5,"y":4},{"name":"tree_thin","position":[-18.5,0,-6.5],"rotation":0,"material":3,"x":5,"y":5},{"name":"tree_tall_dark","position":[-19.5,0,-7.5],"rotation":0,"material":3,"x":4,"y":4},{"name":"tree_tall_dark","position":[-19.5,0,-6.5],"rotation":0,"material":3,"x":4,"y":5},{"name":"pine","position":[-18.5,0,-5.5],"rotation":0,"material":3,"x":5,"y":6},{"name":"pine","position":[-19.5,0,-5.5],"rotation":0,"material":3,"x":4,"y":6},{"name":"tree_plateau","position":[-19.5,0,-8.5],"rotation":0,"material":3,"x":4,"y":3},{"name":"tree_plateau","position":[-18.5,0,-8.5],"rotation":0,"material":3,"x":5,"y":3},{"name":"tree_plateau","position":[-18.5,0,-4.5],"rotation":0,"material":3,"x":5,"y":7},{"name":"tree_plateau","position":[-19.5,0,-4.5],"rotation":0,"material":3,"x":4,"y":7},{"name":"flower","position":[-14.5,0,1.5],"rotation":0,"material":2,"x":9,"y":1},{"name":"flower","position":[-14.5,0,2.5],"rotation":0,"material":2,"x":9,"y":2},{"name":"tree_plateau","position":[-20.5,0,5.5],"rotation":0,"material":2,"x":3,"y":5},{"name":"tree_thin","position":[-20.5,0,1.5],"rotation":0,"material":2,"x":3,"y":1},{"name":"stone_small","position":[-13.5,0,-4.5],"rotation":0,"material":3,"x":10,"y":7},{"name":"stone_large","position":[-21.5,0,8.5],"rotation":0,"material":2,"x":2,"y":8},{"name":"pine","position":[-19.5,0,-15.5],"rotation":0,"material":4,"x":4,"y":8},{"name":"flower","position":[-16.5,0,-3.5],"rotation":0,"material":3,"x":7,"y":8},{"name":"flower","position":[-16.5,0,-2.5],"rotation":0,"material":3,"x":7,"y":9},{"name":"flower","position":[-18.5,0,-3.5],"rotation":0,"material":3,"x":5,"y":8},{"name":"flower","position":[-20.5,0,-5.5],"rotation":0,"material":3,"x":3,"y":6},{"name":"flower","position":[-20.5,0,-7.5],"rotation":0,"material":3,"x":3,"y":4},{"name":"flower","position":[-19.5,0,-9.5],"rotation":0,"material":3,"x":4,"y":2},{"name":"flower","position":[-17.5,0,-7.5],"rotation":0,"material":3,"x":6,"y":4},{"name":"stone_small","position":[-20.5,0,-4.5],"rotation":0,"material":3,"x":3,"y":7},{"name":"stone_small","position":[-20.5,0,-6.5],"rotation":0,"material":3,"x":3,"y":5},{"name":"stone_small","position":[-20.5,0,-8.5],"rotation":0,"material":3,"x":3,"y":3},{"name":"stone_small","position":[-18.5,0,-9.5],"rotation":0,"material":3,"x":5,"y":2},{"name":"stone_small","position":[-17.5,0,-6.5],"rotation":0,"material":3,"x":6,"y":5},{"name":"stone_small","position":[-17.5,0,-5.5],"rotation":0,"material":3,"x":6,"y":6},{"name":"tree_tall_dark","position":[-23.5,0,-10.5],"rotation":0,"material":3,"x":0,"y":1},{"name":"tree_thin","position":[-23.5,0,-8.5],"rotation":0,"material":3,"x":0,"y":3},{"name":"tree_plateau","position":[-23.5,0,-6.5],"rotation":0,"material":3,"x":0,"y":5},{"name":"pine","position":[-23.5,0,-4.5],"rotation":0,"material":3,"x":0,"y":7},{"name":"palm_tree","position":[-7.5,0,5.5],"rotation":0,"material":1,"x":4,"y":5},{"name":"house","position":[-20.5,0,3.5],"rotation":0,"material":2,"x":2,"y":2},{"name":"house","position":[-15.5,0,6.5],"rotation":0,"material":2,"x":7,"y":5},{"name":"flower","position":[-14.5,0,10.5],"rotation":0,"material":2,"x":9,"y":10},{"name":"flower","position":[-14.5,0,9.5],"rotation":0,"material":2,"x":9,"y":9},{"name":"stone_small","position":[-22.5,0,3.5],"rotation":0,"material":2,"x":1,"y":3}]}')},2:function(e,t,n){"use strict";var i,a;function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"l",(function(){return o})),n.d(t,"h",(function(){return l})),n.d(t,"d",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"i",(function(){return u})),n.d(t,"b",(function(){return f})),n.d(t,"k",(function(){return m})),n.d(t,"f",(function(){return d})),n.d(t,"a",(function(){return p})),n.d(t,"e",(function(){return v})),n.d(t,"j",(function(){return y})),n.d(t,"g",(function(){return h}));var o=0,l=1,s=2,c=3,u=4,f=6,m=8,d=["Water","Sand","Grass","Forest","Stone","Ice","Dirt","Packed_Ice"],p=[null,"case-1","case-2","case-3","case-4","case-5-1","case-6","case-7","case-8","case-9","case-10-1","case-11","case-12","case-13","case-14","case-15","case-m1","case-m2","case-m3","case-m4","case-5-2","case-10-2"],v=(r(i={},o,[0,.4,.8]),r(i,l,[.8,.8,0]),r(i,s,[0,.7,0]),r(i,f,[.5,.3,.1]),r(i,c,[.2,.5,.3]),r(i,u,[.5,.5,.5]),r(i,5,[1,1,1]),r(i,7,[1,1,1]),r(i,m,[1,0,1]),i),y=(r(a={},o,0),r(a,l,1),r(a,s,1),r(a,f,1),r(a,c,1),r(a,u,.4),r(a,5,.9),r(a,7,.8),r(a,m,0),2*Math.PI),h=(1+Math.sqrt(5))/2},33:function(e,t,n){},40:function(e,t,n){"use strict";n.r(t);var i=n(7),a=n.n(i),r=n(3),o=n.n(r),l=n(19),s=n.n(l),c=(n(6),n(0)),u=n(5),f=n(2);function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d,p,v,y,h,b=f.b,w=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=n,this.size=t,this.data=new Float64Array(t*t*b);var a=new Float64Array(2*b);this.offsets=a;var r=1*-t/2,o=1*-t/2,l=0,s=1*t,u=0,m=1,d=m,p=!1,v=new c.q;v.name="MaterialGrid";for(var y=0;y<b;y++){if(a[u++]=r,a[u++]=o,n){var h=new c.W(1*t,1*t,1,1),w=i[y].clone();w.side=c.l;var g=new c.J(h,w);g.name="M"+y,g.position.set(r,o,0),v.add(g)}if(r+=l,o+=s,0==--d){var x=l;l=-s,s=x,p&&m++,p=!p,d=m}}v.rotation.x=f.j/4,n&&(this.group=v,n.add(v))}var t,n,i;return t=e,(n=[{key:"setTile",value:function(e,t,n,i,a){for(var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=this.size,l=i.sizeX,s=i.sizeZ,c=2*a,u=t+g[c]*(l-1),f=n+g[c+1]*(s-1),m=x[c],d=x[c+1],p=e*o*o,v=!r,y=!v&&new Array(l*s),h=-m*l-d,b=-d*s+m,w=0,j=0;j<s;j++){for(var O=0;O<l;O++){var _=p+u+f*o,E=i.pattern[j*l+O];v?this.data[_]===E&&(this.data[_]=0):(0!==this.data[_]&&"function"==typeof r&&r(_),y[w++]=_,this.data[_]=E),u+=m,f+=d}u+=h,f+=b}return y}},{key:"clearTile",value:function(e){this.setTile(e.material,e.x,e.y,e.tile,e.rotation,null)}}])&&m(t.prototype,n),i&&m(t,i),e}(),g=[0,0,1,0,1,1,0,1],x=[1,0,0,1,-1,0,0,-1],j=n(14),O=n(11),_=n(12),E=n.n(_),T=(n(33),n(25)),z=function(e){var t=e.elem,n=e.index,i=e.active,a=e.onClick,l=Object(r.useRef)(null);return Object(r.useEffect)((function(){l.current.appendChild(t)}),[]),o.a.createElement("button",{ref:l,type:"button",className:E()("btn btn-sm m-1",i===n?"btn-light":"btn-default"),onClick:a})},P=Object(r.memo)((function(e){var t=e.sizeX,n=e.sizeY;return o.a.createElement("span",{className:"badge badge-secondary ml-1",style:{visibility:1===t&&1===n&&"hidden"}},t+"x"+n)})),k=Object(T.a)((function(e){var t=e.editorState,n=e.download,i=e.clearAll,a=t.tiles,r=t.visible,l=t.activeTileIndex,s=t.activeTile,c=t.dirty;return o.a.createElement(o.a.Fragment,null,o.a.createElement("button",{type:"button",accessKey:"u",className:E()("btn btn-default toggle",r&&"visible"),onClick:function(){return t.toggleVisible()}},o.a.createElement("i",{className:"fas fa-arrows-alt-h"})),o.a.createElement("div",{className:E()("sidebar",r&&"visible"),onFocusCapture:function(){return t.toggleVisible(!0)}},o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col"},o.a.createElement("p",{className:"form-control-plaintext border-bottom"},o.a.createElement("strong",null,"Island Rules Builder")))),o.a.createElement("div",{className:"row small"},o.a.createElement("div",{className:"col"},o.a.createElement("strong",null,"Selected:"),"Â ",s.name,o.a.createElement(P,{sizeX:s.sizeX,sizeY:s.sizeZ}))),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"tile-selector flex"},a.map((function(e,n){return o.a.createElement(z,{key:n,index:n,active:l,onClick:function(){return t.selectTile(n)},elem:e.thumbnail})})))),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col"},o.a.createElement("i",{className:E()("fas mr-1",c?"fa-spinner rotating":"fa-check",c?"text-muted":"text-success"),title:c?"Write pending":"Synched to localStorage"}),o.a.createElement("button",{type:"button",className:"btn btn-sm btn-secondary mr-1",onClick:n},"Download JSON"),o.a.createElement("button",{type:"button",className:"btn btn-sm btn-danger mr-1",onClick:function(){confirm("Do you really want to delete all tiles?")&&i()}},"Clear"))))))})),S=n(4);function C(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function A(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function I(e,t,n,i,a){var r={};return Object.keys(i).forEach((function(e){r[e]=i[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),r),a&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(a):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var M=(d=S.action.bound,v=I((p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),C(this,"visible",v,this),C(this,"dirty",y,this),C(this,"activeTileIndex",h,this),this.tiles=t}var t,n,i;return t=e,(n=[{key:"toggleVisible",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.visible;this.visible=e}},{key:"selectTile",value:function(e){this.activeTileIndex=e}},{key:"setDirty",value:function(e){this.dirty=e}},{key:"activeTile",get:function(){var e=this.activeTileIndex;return this.tiles[e]}}])&&A(t.prototype,n),i&&A(t,i),e}()).prototype,"visible",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),y=I(p.prototype,"dirty",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),h=I(p.prototype,"activeTileIndex",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),I(p.prototype,"toggleVisible",[S.action],Object.getOwnPropertyDescriptor(p.prototype,"toggleVisible"),p.prototype),I(p.prototype,"selectTile",[d],Object.getOwnPropertyDescriptor(p.prototype,"selectTile"),p.prototype),I(p.prototype,"setDirty",[S.action],Object.getOwnPropertyDescriptor(p.prototype,"setDirty"),p.prototype),p),D=(n(34),n(8)),N={cactus:{variants:["cactus_short","cactus_tall"]},flower:{variants:["flower_purpleA","flower_purpleB","flower_purpleC","flower_redA","flower_redB","flower_redC","flower_yellowA","flower_yellowB","flower_yellowC"]},stone_large:{variants:["stone_largeD","stone_largeE","stone_largeF"]},stone_small:{variants:["stone_smallD"]},palm_tree:{variants:["tree_palmDetailedTall","tree_palmShort","tree_palmTall"]},pine:{variants:["tree_pineRoundD","tree_pineTallC_detailed","tree_pineTallD"]},tree_plateau:{variants:["tree_plateau"]},tree_tall_dark:{variants:["tree_tall_dark"]},tree_thin:{variants:["tree_thin"]},house:{variants:["House"],sizeX:3,sizeY:2,sizeZ:3,idCount:2,pattern:[1,1,1,1,0,1,1,1,1]}},X=n(26);function F(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var R=new c.i("#fff"),Y=new c.i("#ff3c78");var Z=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.grid=n,this.editorState=i,this.raycaster=new c.fb,this.material=0,this.current=null,this.object=function(){var e=new c.x({color:0,linewidth:1.5,depthTest:!1,opacity:.5,transparent:!0}),t=[];t.push(new c.wb(-.5,0,-.5)),t.push(new c.wb(.5,0,-.5)),t.push(new c.wb(.5,0,.5)),t.push(new c.wb(-.5,0,.5)),t.push(new c.wb(-.5,0,-.5));var n=new c.w((new X.a).setFromPoints(t),e),i=new c.J(new c.W(1,1),new c.K({color:16777215,depthTest:!1,opacity:.2,transparent:!0}));i.rotation.x=-f.j/4;var a=new c.q;return a.add(i),a.add(n),a}(),this.valid=!1,t.add(this.object)}var t,n,i;return t=e,(n=[{key:"setValid",value:function(e){this.valid=!!e,this.object.children[0].material.color=e?R:Y,this.object.children[0].material.opacity=e?.2:.8}},{key:"update",value:function(e,t){var n=this.grid,i=this.raycaster,a=this.object,r=this.editorState;i.setFromCamera(e,t);var o=i.intersectObjects(n.group.children);if(o.length>0){this.current!==o[0].object&&(this.current=o[0].object,this.material=+this.current.name.substr(1));var l=o[0].point,s=r.activeTile,c=s.sizeX,u=(s.sizeY,s.sizeZ),f=2*this.material,m=n.offsets[f],d=n.offsets[f+1],p=Math.floor((l.x-m)/1)+n.size/2,v=Math.floor((l.z-d)/1)+n.size/2,y=p+c<=n.size&&v+u<=n.size;this.setValid(y);var h=m+1*(p-n.size/2)+c/2,b=d+1*(v-n.size/2)+u/2;a.position.x===h&&a.position.z===b||(this.x=p,this.y=v,a.position.set(h,0,b)),this.object.visible=!0}else this.object.visible=!1,this.valid=!1,this.current=null}}])&&F(t.prototype,n),i&&F(t,i),e}();function J(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var V=0,B=function(){function e(t,n,i,a,r,o,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=void 0,this.tile=void 0,this.position=void 0,this.object=null,this.indexes=null,this.id=++V,this.scene=t,this.tile=n,this.position=i.clone(),this.rotation=a,this.material=r,this.x=o,this.y=l,t&&this.createObject()}var t,n,i;return t=e,(n=[{key:"createObject",value:function(){var e=this.tile,t=this.scene,n=this.position,i=this.rotation,a=e.variants;this.variant=Math.random()*a.length|0;var r=a[this.variant].clone();r.scale.set(1,1,1),r.position.copy(n),r.rotation.y=f.j*i/4,this.object=r,t.add(r)}},{key:"removeObject",value:function(){var e=this.scene,t=this.object;t&&(e.remove(t),this.object=null)}}])&&J(t.prototype,n),i&&J(t,i),e}(),H=n(16),L=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/plain",i=document.createElement("a");i.setAttribute("href","data:"+n+";charset=utf-8,"+encodeURIComponent(t)),i.setAttribute("download",e),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)};function W(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i.name===t)return i}return null}function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(){var e=document.createElement("canvas");e.width=$,e.height=Q;var t=e.getContext("2d");t.lineWidth=4,t.strokeStyle="rgba(255,64,64,0.5)",t.fillStyle="#fff";var n=.5*$,i=.5*Q,a=.3*Math.min(i,n);return t.beginPath(),t.moveTo(-a+n,-a+i),t.lineTo(a+n,a+i),t.moveTo(a+n,-a+i),t.lineTo(-a+n,a+i),t.rect(0,0,$,Q),t.stroke(),t.fillText("None",4,Q-4),e}var $=40,Q=$/.75;function ee(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,a=!1,r=void 0;try{for(var o,l=e[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{i||null==l.return||l.return()}finally{if(a)throw r}}return n}(e,t)||ae(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=ae(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a,r=!0,o=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return r=e.done,e},e:function(e){o=!0,a=e},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw a}}}}function ie(e){return function(e){if(Array.isArray(e))return re(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||ae(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ae(e,t){if(e){if("string"==typeof e)return re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?re(e,t):void 0}}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var oe,le,se,ce,ue,fe,me,de,pe,ve,ye,he,be=2*Math.PI,we=new Set,ge=1e3,xe=.1,je=.1;function Oe(){return window.innerWidth-(Je.visible?220:0)}function _e(e){e.preventDefault(),Ee.x=e.clientX/Oe()*2-1,Ee.y=-e.clientY/window.innerHeight*2+1}var Ee=new c.vb(100,0);function Te(){se.aspect=Oe()/window.innerHeight,se.updateProjectionMatrix(),ue.setSize(Oe(),window.innerHeight)}function ze(){pe.update(Ee,se),Ze&&(Ze.rotation.y=be*Ve/4,Ze.position.copy(pe.object.position)),function(){performance.now();ue.render(ce,se)}(),me&&me.update(),a()(ze)}var Pe=[];function ke(e){var t=e.timestamp;"string"==typeof t&&(e.timestamp=new Date(t))}function Se(){var e=function(){var e=localStorage.getItem("@fforw/islands:data");if(!e)return null;var t=JSON.parse(e);return ke(t),t}();return!e||e.timestamp.getTime()<H.timestamp.getTime()?(console.info("Loading input JSON"),e=H):console.info("Loading from localStorage"),function(e,t,n,i,a){for(var r=e.instances,o=new Set,l=0;l<r.length;l++){var s=r[l],u=W(t,s.name);if(u){var f=new B(a,u,new c.wb(s.position[0],s.position[1],s.position[2]),s.rotation,s.material,s.x,s.y);f.variant=Math.random()*u.variants.length|0,f.indexes=s.indexes,f.indexes=n.setTile(f.material,f.x,f.y,f.tile,f.rotation,!0),i&&i.add(f)}else o.add(s.name)}o.size>0&&console.log("Could not find some tiles: ",o)}(e,Pe,le,we,ce)}function Ce(){return JSON.stringify({version:1,timestamp:(new Date).toISOString(),instances:ie(we).map((function(e){return{name:e.tile.name,position:[e.position.x,e.position.y,e.position.z],rotation:e.rotation,material:e.material,x:e.x,y:e.y}}))},null,4)}ke(H);var Ae,Ie=[],Me=0,De=0;function Ne(){Je.setDirty(!0),Ae&&(clearTimeout(Ae),Ae=null),Ae=setTimeout(Xe,1e3)}function Xe(){Ae=null,Je.setDirty(!1),localStorage.setItem("@fforw/islands:data",Ce())}function Fe(e){var t=Je.activeTile;if(pe.valid){var n=0!==t.id?new B(ce,t,Ze.position,Ve,pe.material,pe.x,pe.y):null,i=[],a=le.setTile(pe.material,pe.x,pe.y,t,Ve,(function(e){var t,n=ne(we);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.indexes.indexOf(e)>=0){le.clearTile(a),a.removeObject(),i.push(a),we.delete(a);break}}}catch(e){n.e(e)}finally{n.f()}}));n&&(n.indexes=a,we.add(n)),Re(n,i),Ne()}}function Re(e,t){var n={added:e,removed:t};if(Me<32)Ie[Me++]=n,De=Me;else{for(var i=0;i<Me;i++)Ie[i]=Ie[i+1];Ie[Me]=n}}function Ye(e){var t=e.keyCode;82===t?Ve=Ve+(e.shiftKey?1:-1)&3:90===t&&e.ctrlKey&&(e.shiftKey?function(){if(Me<De){var e=Ie[Me++],t=e.added,n=e.removed;if(t&&(le.setTile(t.material,t.x,t.y,t.tile,t.rotation,!0),t.createObject(),we.add(t)),n)for(var i=0;i<n.length;i++){var a=n[i];le.clearTile(a),a.removeObject(),we.delete(a)}Ne()}}():function(){if(Me>0){var e=Ie[--Me],t=e.added,n=e.removed;if(t&&(le.clearTile(t),t.removeObject(),we.delete(t)),n)for(var i=0;i<n.length;i++){var a=n[i];le.setTile(a.material,a.x,a.y,a.tile,a.rotation,!0),a.createObject(),we.add(a)}Ne()}}())}Promise.all([Object(u.a)("assets/ground.glb"),Object(u.a)("assets/tiles.glb").then((function(e){var t=[],n=0;for(var i in N)N.hasOwnProperty(i)&&function(){var a=N[i],r=a.variants,o=a.sizeX,l=void 0===o?1:o,s=a.sizeY,c=void 0===s?1:s,u=a.sizeZ,f=void 0===u?1:u;t[n]=U(U({},a),{},{id:-1,idCount:a.idCount||1,name:i,sizeX:l,sizeY:c,sizeZ:f,variants:e?e.scene.children.filter((function(e){return r.indexOf(e.name)>=0})):r,thumbnail:null}),n++}();t.sort((function(e,t){return e.name===t.name?0:e.name<t.name?-1:1}));var a=1;if(t.forEach((function(e){var t=e.name,n=e.idCount,i=e.pattern,r=e.sizeX,o=e.sizeZ;if(e.id=a,a+=n,n>1){if(!i||!Array.isArray(i))throw new Error("Tile '"+t+"': tiles with idCount > 1 must define a pattern");var l=r*o;if(i.length!==l)throw new Error("Tile '"+t+"': Pattern must be "+r+" x "+o+" = "+l+" elements long: "+i);for(var s=0;s<i.length;s++)i[s]+=e.id}else e.pattern=[e.id]})),e){var r=[],o=[];return t.forEach((function(e,t){r[t]=e.name,o[t]=e.variants[0]})),Object(D.a)(o,$,Q,r).then((function(e){return e.forEach((function(e,n){return t[n].thumbnail=e})),t.unshift({id:0,idCount:1,name:"empty",variants:[],sizeX:1,sizeY:.1,sizeZ:1,thumbnail:G(),pattern:[0]}),t}))}return t.unshift({id:0,name:"empty",variants:[],sizeX:1,sizeY:.1,sizeZ:1,thumbnail:null}),t}))]).then((function(e){var t=te(e,2),n=t[0],i=t[1];Pe.push.apply(Pe,ie(i)),console.log({tiles:Pe}),de=f.f.map((function(e){var t=n.scene.children.find((function(t){return t.name===e}));if(!t)throw new Error("Could not find "+e);return t.material})),document.title+=" Rule Editor",oe=document.getElementById("container"),(ue=new c.Ab).setPixelRatio(window.devicePixelRatio),ue.setSize(Oe(),window.innerHeight),ue.outputEncoding=c.Cb,oe.appendChild(ue.domElement),(ve=document.createElement("div")).setAttribute("id","root"),oe.appendChild(ve),ce=new c.hb,(se=new c.U(55,Oe()/window.innerHeight,1,2e4)).up.set(0,1,0);se.position.set(-35,35,0),se.lookAt(new c.wb(0,0,0)),se.updateProjectionMatrix(),fe=new c.k("#fff8d5",1.4),ce.add(fe),ye=new c.j(.2,1,512),ce.background=ye.renderTarget;(he=new O.a).material.uniforms;ye.renderTarget.texture,function(){if(he){var e=Math.PI*(xe-.5),t=2*Math.PI*(je-.5);fe.position.x=ge*Math.cos(t),fe.position.y=ge*Math.sin(t)*Math.sin(e),fe.position.z=ge*Math.sin(t)*Math.cos(e),he.material.uniforms.sunPosition.value=fe.position.copy(fe.position),ye.update(ue,he)}}(),(me=new j.a(se,ue.domElement)).maxPolarAngle=Math.PI,me.target.set(0,0,0),me.minDistance=0,me.maxDistance=1500,me.enableDamping=!0,me.dampingFactor=.02,me.mouseButtons={MIDDLE:c.F.ROTATE,RIGHT:c.F.PAN},me.update(),le=new w(12,ce,de),(pe=new Z(ce,le,Je)).update(Ee,se),document.addEventListener("mousemove",_e,!1),document.addEventListener("keydown",Ye,!1),window.addEventListener("resize",Te,!1),oe.addEventListener("click",Fe,!1),Se(),Je.selectTile(1),new Promise((function(e,t){try{s.a.render(o.a.createElement(k,{editorState:Je,clearAll:Be,download:function(){L("input.json",Ce(),"text/json")}}),ve,e)}catch(e){t(e)}})).then(ze)}));var Ze,Je=new M(Pe);Object(S.reaction)((function(){return Je.visible}),Te);var Ve=0;function Be(){var e,t=ne(we);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.removeObject(),le.clearTile(n)}}catch(e){t.e(e)}finally{t.f()}Re(null,ie(we)),we.clear(),Ne()}Object(S.reaction)((function(){return Je.activeTileIndex}),(function(){var e=Je.activeTile,t=Je.activeTileIndex;pe.object.scale.set(e.sizeX,e.sizeY,e.sizeZ),Ze&&(!function e(t){t.material&&t.material.dispose();var n=t.children;if(n)for(var i=0;i<n.length;i++)e(n[i])}(Ze),ce.remove(Ze)),0===t?Ze=null:((Ze=Pe[t].variants[0].clone()).scale.set(1,1,1),function e(t,n){t.material&&(t.material=t.material.clone(),t.material.transparent=n<1,t.material.opacity=n);var i=t.children;if(i)for(var a=0;a<i.length;a++)e(i[a],n)}(Ze,.2),Ze.rotation.y=be*Ve/4,console.log({ghost:Ze}),ce.add(Ze)),console.log("ACTIVE",e)}));var He=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.KEY="@fforw/islands:data",this.download=L}var t,n,i;return t=e,(n=[{key:"grid",get:function(){return le}}])&&ee(t.prototype,n),i&&ee(t,i),e}();t.default=new He},5:function(e,t,n){"use strict";var i=new(n(9).a);t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,a){i.load(e,n,t,a)}))}},6:function(e,t,n){},8:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(0);function a(e,t,n,a){return new Promise((function(r){var o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.top="0px",o.style.left="-10000px";var l=new i.Ab({alpha:!0});l.setPixelRatio(window.devicePixelRatio),l.setSize(t,n),o.appendChild(l.domElement);var s=new i.hb,c=new i.U(55,t/n,.1,100),u=new i.k("#fff8d5",1.4);u.position.set(0,3,-1.5),s.add(u);for(var f,m=[],d=0;d<e.length;d++){f&&s.remove(f),f=e[d].clone();var p=new i.d;p.expandByObject(f);var v=Math.max(p.max.x-p.min.x,p.max.y-p.min.y),y=v<1.5,h=y?1.2*Math.pow(v,.9):1.5*v;c.up.set(0,1,0),c.position.set(0,p.max.y*(y?1.1:.9),-h),c.lookAt(new i.wb(0,(p.max.y+p.min.y)/(y?2:4),0)),c.updateProjectionMatrix(),f.position.set(0,0,0),s.add(f),l.render(s,c);var b=document.createElement("canvas");b.width=t,b.height=n;var w=b.getContext("2d");w.drawImage(l.domElement,0,0),w.strokeStyle="rgba(255,255,255,0.4)",w.fillStyle="#fff",w.lineWidth=2,w.beginPath(),w.rect(0,0,t,n),w.stroke();var g=a?a[d]:f.name;w.fillText(g,4,n-4),m.push(b)}r(m),s.dispose(),l.dispose(),document.body.removeChild(o)}))}}}).default;
//# sourceMappingURL=bundle-editor-2564f8d7b425fe24474c.js.map