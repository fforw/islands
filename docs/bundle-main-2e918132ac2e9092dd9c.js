var App=function(e){function t(t){for(var r,o,s=t[0],l=t[1],u=t[2],c=0,d=[];c<s.length;c++)o=s[c],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(f&&f(t);d.length;)d.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var l=n[s];0!==a[l]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={4:0},i=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var s=window.webpackJsonpApp=window.webpackJsonpApp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var f=l;return i.push([45,0]),n()}([,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Vector",{enumerable:!0,get:function(){return a.default}}),t.default=t.t_size=t.t_tile3=t.t_tile2=t.t_tile1=t.t_tile0=t.t_isEdge=t.t_n3=t.t_n2=t.t_n1=t.t_n0=t.g_size=t.g_edge5=t.g_edge4=t.g_edge3=t.g_edge2=t.g_edge1=t.g_edge0=t.g_count=t.g_isEdge=t.g_y=t.g_x=t.f_size=t.f_outmostEdge=t.f_count=t.f_y3=t.f_x3=t.f_y2=t.f_x2=t.f_y1=t.f_x1=t.f_y0=t.f_x0=void 0;var r=i(n(29)),a=i(n(27));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||c(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}t.f_x0=0;t.f_y0=1;t.f_x1=2;t.f_y1=3;t.f_x2=4;t.f_y2=5;t.f_x3=6;t.f_y3=7;t.f_count=8;t.f_outmostEdge=9;t.f_size=10;t.g_x=0;t.g_y=1;t.g_isEdge=2;t.g_count=3;t.g_edge0=4;t.g_edge1=5;t.g_edge2=6;t.g_edge3=7;t.g_edge4=8;t.g_edge5=9;t.g_size=10;t.t_n0=0;t.t_n1=1;t.t_n2=2;t.t_n3=3;t.t_isEdge=4;t.t_tile0=5;t.t_tile1=6;t.t_tile2=7;t.t_tile3=8;t.t_size=9;var h=2*Math.PI/6;var v={width:0,height:0,numberOfRings:5,removeEdges:50,animatedEasing:!0,renderFirstPassEdges:!1,debug:!1,weightFunction:function(e,t,n,r){var a=n-e,i=r-t;return Math.sqrt(a*a+i*i)},edgeLength:80,maxIterations:100,animating:!0,minTension:2};function m(e,t,n,r,a,i,o){for(var s=0;s<e.length;s+=10)if(s!==i){var l=e[s+8];if(e[s+0]===r&&e[s+1]===a&&e[s+2]===t&&e[s+3]===n)return o.index=s,void(o.edge=0);if(e[s+2]===r&&e[s+3]===a&&e[s+4]===t&&e[s+5]===n)return o.index=s,void(o.edge=1);if(3===l){if(e[s+4]===r&&e[s+5]===a&&e[s+0]===t&&e[s+1]===n)return o.index=s,void(o.edge=2)}else{if(e[s+4]===r&&e[s+5]===a&&e[s+6]===t&&e[s+7]===n)return o.index=s,void(o.edge=2);if(e[s+6]===r&&e[s+7]===a&&e[s+0]===t&&e[s+1]===n)return o.index=s,void(o.edge=3)}}o.index=-1}var g={index:-1,edge:0};function y(e,t){var n=e.firstPassNumEdges*e.removeEdges/100|0,r=function(e,t){for(var n=3*e.numFaces,r=new Int32Array(n),a=0,i=0;i<e.firstPassLen;i+=10){if(!(t[i+9]>=0)){var o=i<<2;r[a++]=o,r[a++]=o+1,r[a++]=o+2}}for(var s=0;s<a-2;s++){var l=s+(Math.random()*a-s-1|0),u=r[s];r[s]=r[l],r[l]=u}return r.slice(0,a)}(e,t);e.debug&&console.log("Shuffled stack",f(r.slice()));for(var a=0,i=function(e){for(var t=a;t<r.length;t++)r[t]>>>2===e&&(r[t]=-1)},o=0,s=0;s<n;s++){var l=void 0;do{if(a===r.length)return void(e.debug&&e.debug&&console.log("Ran out of removal candidates after successfully removing",o,"out of",n));l=r[a++]}while(-1===l);var u=l>>2,c=3&l;if(m(t,t[u+2*c],t[u+2*c+1],2===c?t[u+0]:t[u+2*(c+1)],2===c?t[u+1]:t[u+2*(c+1)+1],u,g),g.index>=0&&3===t[g.index+8]){var d=g.index,h=g.edge,v=0===c?t[u+4]:t[u+2*(c-1)],y=0===c?t[u+5]:t[u+2*(c-1)+1],p=t[d+9]>=0;switch(t[d+8]=4,h){case 2:t[d+6]=v,t[d+7]=y;break;case 1:t[d+6]=t[d+4],t[d+7]=t[d+5],t[d+4]=v,t[d+5]=y;break;case 0:t[d+6]=t[d+4],t[d+7]=t[d+5],t[d+4]=t[d+2],t[d+5]=t[d+3],t[d+2]=v,t[d+3]=y,p&&(t[d+9]=2)}i(d),t[u+8]=0,o++}i(u)}return e.debug&&console.log("Successfully removed",o,"out of",n),o}function p(e,t){for(var n=e.firstPassLen,r=function(e,t){for(var n=0,r=0,a=0;a<e.firstPassLen;a+=10){var i=t[a+8];3===i?n++:4===i&&r++}return 9*r+7*n}(e,t),a=new Float64Array(10*r),i=new Int32Array(9*(r/2|0)),o=0,s=0,l=function(e,t,n){e|=0,t|=0;for(var r=0;r<o;r+=10)if(Math.abs(a[r]-e)<4&&Math.abs(a[r+1]-t)<4)return n&&!a[r+2]&&(a[r+2]=1),r;var i=o;return a[o+0]=e,a[o+1]=t,a[o+2]=n?1:0,a[o+3]=0,o+=10,i},u=function(e,t,n,r){i[s+0]=e,i[s+1]=t,i[s+2]=n,i[s+3]=r,s+=9},f=function(e,t){for(var n=a[e+3],r=!1,i=0;i<n;i++){if(a[e+4+i]===t){r=!0;break}}if(!r){if(n>=6)throw new Error("At most 6 edges per node");a[e+4+n++]=t,a[e+3]=n}},c=function(e,t){f(e,t),f(t,e)},d=0;d<n;d+=10){var h=t[d+8],v=t[d+0],m=t[d+1],g=t[d+2],y=t[d+3],p=t[d+4],b=t[d+5],_=t[d+9],w=1===_,x=2===_;if(3===h){var O=(v+g)/2,j=(m+y)/2,M=(g+p)/2,P=(y+b)/2,S=(p+v)/2,A=(b+m)/2,z=(v+g+p)/3,k=(m+y+b)/3,E=l(v,m),T=l(O,j),I=l(g,y,w),C=l(M,P,w),F=l(p,b,w),L=l(S,A),D=l(z,k);c(E,T),c(T,D),c(D,L),c(L,E),c(T,I),c(I,C),c(C,D),c(D,T),c(L,D),c(D,C),c(C,F),c(F,L),u(E,T,D,L),u(T,I,C,D),u(L,D,C,F)}else if(4===h){var R=t[d+6],B=t[d+7],N=(v+g)/2,U=(m+y)/2,W=(g+p)/2,Z=(y+b)/2,G=(p+R)/2,H=(b+B)/2,X=(R+v)/2,q=(B+m)/2,Y=(v+g+p+R)/4,$=(m+y+b+B)/4,J=l(v,m),Q=l(N,U),V=l(g,y,w),K=l(W,Z,w),ee=l(p,b,w||x),te=l(G,H,x),ne=l(R,B,x),re=l(X,q),ae=l(Y,$);c(J,Q),c(Q,V),c(V,K),c(K,ee),c(ee,te),c(te,ne),c(ne,re),c(re,J),c(ae,K),c(ae,te),c(ae,re),c(ae,Q),u(J,Q,ae,re),u(Q,V,K,ae),u(ae,K,ee,te),u(re,ae,te,ne)}}console.log("TILES: buffer = ",i.length,", used = "+s);var ie=i.slice(0,s);return function(e,t){for(var n=t.length,r=0;r<n;r+=9){for(var a=0,i=0;i<4;i++){for(var o=t[r+0+i],s=3===i?t[r+0]:t[r+0+i+1],l=-1,u=0;u<t.length;u+=9)if(u!==r){var f=t[u+0],c=t[u+1],d=t[u+2],h=t[u+3];if(c===o&&f===s||d===o&&c===s||h===o&&d===s||f===o&&h===s){l=u,a++;break}}t[r+5+i]=l}t[r+4]=4===a?0:1}e.debug&&console.log("TILE GRAPH",t)}(e,ie),[a.slice(0,o),ie]}function b(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=t.length,a=0;a<n;a++){for(var i=0,o=0;o<r;o+=10)if(!t[o+2]){for(var s=t[o+0],l=t[o+1],u=t[o+3],f=0,c=0,d=0,h=0;h<u;h++){var v=t[o+4+h],m=t[v],g=t[v+1],y=e.weightFunction(s,l,m,g);f+=m*y,c+=g*y,d+=y}var p=f/d,b=c/d,_=p-s,w=b-l;t[o+0]=p,t[o+1]=b,i+=_*_+w*w}if(i<e.minTension)return e.debug&&console.log("Reached minimal tension",e.minTension,"after",e.relaxCount,"iterations"),!0;e.relaxCount++}return e.animatedEasing||e.debug&&console.log("Stopping after max iterations = "+e.maxIterations),!1}var _=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.render=function(e){var t=n.config,r=n.graph,a=n.faces;e.save();var i=t.width/2,o=t.height/2;e.translate(i,o);r.length;if(e.fillStyle="#000",e.fillRect(-i,-o,t.width,t.height),t.renderFirstPassEdges){e.strokeStyle="#f00",e.lineWidth=1;for(var s=0;s<t.firstPassLen;s+=10){var l=a[s+8];if(l>=3){e.beginPath(),e.moveTo(a[s+0],a[s+1]);for(var u=1;u<l;u++)e.lineTo(a[s+2*u],a[s+2*u+1]);e.closePath(),e.stroke();var f=a[s+9];f>=0&&(e.strokeStyle="#fe0",e.beginPath(),e.moveTo(a[s+2*f],a[s+2*f+1]),f===l-1?e.lineTo(a[s+0],a[s+1]):e.lineTo(a[s+2*(f+1)],a[s+2*(f+1)+1]),e.stroke(),e.strokeStyle="#f00")}}}e.restore(),t.animating&&b(t,r)&&(t.animating=!1)};var i,s,u=l(l({},v),t);(i=u).numFaces=6*((s=i.numberOfRings)+1)*(s+1),i.firstPassLen=10*i.numFaces,i.firstPassNumEdges=3*i.numFaces,i.edgeLength=Math.min(i.width,i.height)/(2*i.numberOfRings+2)|0,i.animating=i.animatedEasing,i.relaxCount=0,this.config=u;var f=function(e){var t=e.numberOfRings,n=[new a.default(Math.cos(0)*e.edgeLength,Math.sin(0)*e.edgeLength),new a.default(Math.cos(h)*e.edgeLength,Math.sin(h)*e.edgeLength),new a.default(Math.cos(2*h)*e.edgeLength,Math.sin(2*h)*e.edgeLength),new a.default(Math.cos(3*h)*e.edgeLength,Math.sin(3*h)*e.edgeLength),new a.default(Math.cos(4*h)*e.edgeLength,Math.sin(4*h)*e.edgeLength),new a.default(Math.cos(5*h)*e.edgeLength,Math.sin(5*h)*e.edgeLength)],r=new Float64Array(e.firstPassLen),i=0,o=0,s=1;do{for(var l=0;l<6;l++)for(var u=n[l],f=n[(l+1)%6],c=n[(l+2)%6],d=u.copy().scale(o),v=0;v<s;v++)if(1&v)r[i+0]=0|d.x,r[i+1]=0|d.y,r[i+2]=d.x+f.x|0,r[i+3]=d.y+f.y|0,r[i+4]=d.x+c.x|0,r[i+5]=d.y+c.y|0,r[i+8]=3,r[i+9]=-1,i+=10,d.add(c);else{var m=o===t;r[i+0]=0|d.x,r[i+1]=0|d.y,r[i+2]=d.x+u.x|0,r[i+3]=d.y+u.y|0,r[i+4]=d.x+f.x|0,r[i+5]=d.y+f.y|0,r[i+8]=3,r[i+9]=m?1:-1,i+=10}s+=2}while(o++<t);return r}(u);u.renderFirstPassEdges&&(this.faces="merged"!==u.renderFirstPassEdges?f.slice():f);var c=u.debug&&(0,r.default)();y(u,f),u.debug&&console.log("Edge removal in ",(0,r.default)()-c,"ms");var d=o(p(u,f),2),m=d[0],g=d[1];this.tiles=g,u.animating||b(u,m,u.maxIterations),this.graph=m};t.default=_},,function(e,t,n){"use strict";var r,a;function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"l",(function(){return o})),n.d(t,"h",(function(){return s})),n.d(t,"d",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"i",(function(){return f})),n.d(t,"e",(function(){return c})),n.d(t,"b",(function(){return d})),n.d(t,"k",(function(){return h})),n.d(t,"f",(function(){return v})),n.d(t,"a",(function(){return m})),n.d(t,"j",(function(){return g})),n.d(t,"g",(function(){return y}));var o=0,s=1,l=2,u=3,f=4,c=5,d=6,h=8,v=["Water","Sand","Grass","Forest","Stone","Ice","Dirt","Packed_Ice"],m=[null,"case-1","case-2","case-3","case-4","case-5-1","case-6","case-7","case-8","case-9","case-10-1","case-11","case-12","case-13","case-14","case-15","case-m1","case-m2","case-m3","case-m4","case-5-2","case-10-2"],g=(i(r={},o,[0,.4,.8]),i(r,s,[.8,.8,0]),i(r,l,[0,.7,0]),i(r,d,[.5,.3,.1]),i(r,u,[.2,.5,.3]),i(r,f,[.5,.5,.5]),i(r,c,[1,1,1]),i(r,7,[1,1,1]),i(r,h,[1,0,1]),i(a={},o,0),i(a,s,1),i(a,l,1),i(a,d,1),i(a,u,1),i(a,f,.4),i(a,c,.9),i(a,7,.8),i(a,h,0),2*Math.PI),y=(1+Math.sqrt(5))/2},,function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return l}));var r=n(0),a=n(3);n(9);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=1,s=a.b,l=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=n,this.size=t,this.data=new Float64Array(t*t*s);var l=new Float64Array(2*s);this.offsets=l;var u=-t*o/2,f=-t*o/2,c=0,d=t*o,h=0,v=1,m=v,g=!1,y=new r.s;y.name="MaterialGrid";for(var p=0;p<s;p++){if(l[h++]=u,l[h++]=f,n){var b=new r.bb(o*t,o*t,1,1),_=i[p].clone();_.side=r.m;var w=new r.N(b,_);w.name="M"+p,w.position.set(u,f,0),y.add(w)}if(u+=c,f+=d,0==--m){var x=c;c=-d,d=x,g&&v++,g=!g,m=v}}y.rotation.x=a.j/4,n&&(this.group=y,n.add(y))}var t,n,l;return t=e,(n=[{key:"setTile",value:function(e,t,n,r,a){for(var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=this.size,s=r.sizeX,l=r.sizeZ,c=2*a,d=t+u[c]*(s-1),h=n+u[c+1]*(l-1),v=f[c],m=f[c+1],g=e*o*o,y=!i,p=!y&&new Uint32Array(s*l),b=-v*s-m,_=-m*l+v,w=0,x=0;x<l;x++){for(var O=0;O<s;O++){var j=g+d+h*o,M=r.pattern[x*s+O];y?this.data[j]===M&&(this.data[j]=0):(this.data[j]!==M&&"function"==typeof i&&i(j),p[w++]=j,this.data[j]=M),d+=v,h+=m}d+=b,h+=_}return p}},{key:"clearTile",value:function(e){this.setTile(e.material,e.x,e.y,e.tile,e.rotation,null)}}])&&i(t.prototype,n),l&&i(t,l),e}(),u=[0,0,1,0,1,1,0,1],f=[1,0,0,1,-1,0,0,-1]},function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return d}));var r=n(0),a={cactus:{variants:["cactus_short","cactus_tall"],colors:["#0c0"]},flower:{variants:["flower_purpleA","flower_purpleB","flower_purpleC","flower_redA","flower_redB","flower_redC","flower_yellowA","flower_yellowB","flower_yellowC"],colors:["#ff0"]},stone_large:{variants:["stone_largeD","stone_largeE","stone_largeF"],colors:["#eee"]},stone_small:{variants:["stone_smallD"],colors:["#888"]},palm_tree:{variants:["tree_palmDetailedTall","tree_palmShort","tree_palmTall"],colors:["#8c0"]},pine:{variants:["tree_pineRoundD","tree_pineTallC_detailed","tree_pineTallD"],colors:["#480"]},tree_plateau:{variants:["tree_plateau"],colors:["#482"]},tree_tall_dark:{variants:["tree_tall_dark"],colors:["#360"]},tree_thin:{variants:["tree_thin"],colors:["#684"]},house:{variants:["House"],sizeX:3,sizeY:2,sizeZ:3,reachable:!0,colors:["#f00"],idCount:1,pattern:[0,0,0,0,-1,0,0,0,0]}};function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e){return e[e.length-1].id+e[e.length-1].idCount}function u(){var e=document.createElement("canvas");e.width=f,e.height=c;var t=e.getContext("2d");t.lineWidth=4,t.strokeStyle="rgba(255,64,64,0.5)",t.fillStyle="#fff";var n=.5*f,r=.5*c,a=.3*Math.min(r,n);return t.beginPath(),t.moveTo(-a+n,-a+r),t.lineTo(a+n,a+r),t.moveTo(a+n,-a+r),t.lineTo(-a+n,a+r),t.rect(0,0,f,c),t.stroke(),t.fillText("None",4,c-4),e}var f=40,c=f/.75;function d(e){var t=[],n=0;for(var i in a)a.hasOwnProperty(i)&&function(){var r=a[i],s=r.variants,l=r.sizeX,u=void 0===l?1:l,f=r.sizeY,c=void 0===f?1:f,d=r.sizeZ,h=void 0===d?1:d;t[n]=o(o({id:-1,name:i},r),{},{variants:e?e.scene.children.filter((function(e){return s.indexOf(e.name)>=0})):s,pattern:r.pattern?r.pattern.slice():null,idCount:r.idCount||1,sizeX:u,sizeY:c,sizeZ:h,reachable:r.reachable||!1,thumbnail:null}),n++}();t.sort((function(e,t){return e.name===t.name?0:e.name<t.name?-1:1}));var s=1;if(t.forEach((function(e){var t=e.name,n=e.idCount,r=e.pattern,a=e.sizeX,i=e.sizeZ;if(e.id=s,s+=n,e.pattern){if(!r||!Array.isArray(r))throw new Error("Tile '"+t+"': tiles with idCount > 1 must define a pattern");var o=a*i;if(r.length!==o)throw new Error("Tile '"+t+"': Pattern must be "+a+" x "+i+" = "+o+" elements long: "+r);for(var l=0;l<r.length;l++)r[l]<0&&(r[l]=-r[l]-1+e.id)}else e.pattern=[e.id]})),e){var l=[],d=[];return t.forEach((function(e,t){l[t]=e.name,d[t]=e.variants[0]})),function(e,t,n,a){return new Promise((function(i){var o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.top="0px",o.style.left="-10000px";var s=new r.Fb({alpha:!0});s.setPixelRatio(window.devicePixelRatio),s.setSize(t,n),o.appendChild(s.domElement);var l=new r.mb,u=new r.Z(55,t/n,.1,100),f=new r.l("#fff8d5",1.4);f.position.set(0,3,-1.5),l.add(f);for(var c,d=[],h=0;h<e.length;h++){c&&l.remove(c),c=e[h].clone();var v=new r.d;v.expandByObject(c);var m=Math.max(v.max.x-v.min.x,v.max.y-v.min.y),g=m<1.5,y=g?1.2*Math.pow(m,.9):1.5*m;u.up.set(0,1,0),u.position.set(0,v.max.y*(g?1.1:.9),-y),u.lookAt(new r.Bb(0,(v.max.y+v.min.y)/(g?2:4),0)),u.updateProjectionMatrix(),c.position.set(0,0,0),l.add(c),s.render(l,u);var p=document.createElement("canvas");p.width=t,p.height=n;var b=p.getContext("2d");b.drawImage(s.domElement,0,0),b.strokeStyle="rgba(255,255,255,0.4)",b.fillStyle="#fff",b.lineWidth=2,b.beginPath(),b.rect(0,0,t,n),b.stroke();var _=a?a[h]:c.name;b.fillText(_,4,n-4),d.push(p)}i(d),l.dispose(),s.dispose(),document.body.removeChild(o)}))}(d,f,c,l).then((function(e){return e.forEach((function(e,n){return t[n].thumbnail=e})),t.unshift({id:0,name:"empty",variants:[],idCount:1,sizeX:1,sizeY:.1,sizeZ:1,thumbnail:u(),pattern:[0]}),t}))}return t.unshift({id:0,name:"empty",variants:[],idCount:1,sizeX:1,sizeY:.1,sizeZ:1,reachable:!1,colors:["#000"],thumbnail:null}),t}},function(e,t,n){"use strict";var r=new(n(19).a);t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,a){r.load(e,n,t,a)}))}},,function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return l}));var r,a=n(5),i=n(16),o=(n(3),n(6));function s(e,t){for(var n=0;n<e.length;n++){var r=e[n],a=r.name,i=r.id,o=r.idCount;if(t===i)return a;if(t>i&&t<i+o)return a+"-"+(t-i+1)}return isNaN(t),"ERR:"+t}function l(e,t,n,s){var l=Object(o.b)(n),u=l+31>>5;(!r||r.length<u)&&(r=new Uint32Array(u));var f=new a.b(t);Object(i.a)(e,n,f);for(var c=0,d=t-1,h=function(e,t,n,r){var a=r>>5,i=1<<r-(a<<5),o=t*v*u+n*u+a,s=e[o],l=s|i;s!==l&&(e[o]=l)},v=l+1,m=a.c*v,g=new Uint32Array(m),y=a.c*v*u,p=new Uint32Array(y),b=0;b<a.c;b++)for(var _=0;_<t;_++)for(var w=0;w<t;w++){var x=f.data[c];0!==x&&g[b*v+1+x]++;var O=0===_?0:f.data[c-t],j=w===d?0:f.data[c+1],M=_===d?0:f.data[c+t],P=0===w?0:f.data[c-1];h(p,b,x,O),h(p,b,x,j),h(p,b,x,M),h(p,b,x,P),c++}c=0;for(var S=0;S<a.c;S++){r.fill(0);for(var A=0,z=0;z<l;z++){var k=g[c+1+z];if(k>0||0===z){A+=k;var E=z>>5,T=1<<z-(E<<5);r[E]|=T}}var I=S*v*u+l*u;if(0===A)g[c+1]=1,g[c]=1,r[0]|=1;else{var C=A*(s[S]/(1-s[S]));g[c+1]=C,g[c]=A+C}p.set(r,I),c+=v}return{weights:g,adjacencies:p}}},,function(e,t,n){},,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(5),a=(n(0),n(3));function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=0,s=function(){function e(t,n,r,a,i,s,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=void 0,this.tile=void 0,this.position=void 0,this.object=null,this.indexes=null,this.id=++o,this.scene=t,this.tile=n,this.position=r.clone(),this.rotation=a,this.material=i,this.x=s,this.y=l,t&&this.createObject()}var t,n,s;return t=e,(n=[{key:"createObject",value:function(){var e=this.tile,t=this.scene,n=this.position,i=this.rotation,o=e.variants;this.variant=Math.random()*o.length|0;var s=o[this.variant].clone();s.scale.set(r.a,r.a,r.a),s.position.copy(n),s.rotation.y=a.j*i/4,this.object=s,t.add(s)}},{key:"removeObject",value:function(){var e=this.scene,t=this.object;t&&(e.remove(t),this.object=null)}}])&&i(t.prototype,n),s&&i(t,s),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(15),a=n(0);function i(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.name===t)return r}return null}function o(e,t,n,o,s){for(var l=e.instances,u=new Set,f=0;f<l.length;f++){var c=l[f],d=i(t,c.name);if(d){var h=new r.a(s,d,new a.Bb(c.position[0],c.position[1],c.position[2]),4*Math.random()|0,c.material,c.x,c.y);h.variant=Math.random()*d.variants.length|0,h.indexes=n.setTile(h.material,h.x,h.y,h.tile,h.rotation,!0),o&&o.add(h)}else u.add(c.name)}u.size>0&&console.log("Could not find some tiles: ",u)}},function(e){e.exports=JSON.parse('{"version":1,"timestamp":"2020-06-15T19:30:37.781Z","instances":[{"name":"stone_small","position":[-1.5,0,3.5],"material":1,"x":10,"y":3},{"name":"stone_small","position":[-18.5,0,-18.5],"material":4,"x":5,"y":5},{"name":"stone_small","position":[-18.5,0,-17.5],"material":4,"x":5,"y":6},{"name":"stone_large","position":[-20.5,0,-19.5],"material":4,"x":3,"y":4},{"name":"stone_large","position":[-20.5,0,-18.5],"material":4,"x":3,"y":5},{"name":"tree_thin","position":[-18.5,0,-7.5],"material":3,"x":5,"y":4},{"name":"tree_thin","position":[-18.5,0,-6.5],"material":3,"x":5,"y":5},{"name":"tree_tall_dark","position":[-19.5,0,-7.5],"material":3,"x":4,"y":4},{"name":"tree_tall_dark","position":[-19.5,0,-6.5],"material":3,"x":4,"y":5},{"name":"pine","position":[-18.5,0,-5.5],"material":3,"x":5,"y":6},{"name":"pine","position":[-19.5,0,-5.5],"material":3,"x":4,"y":6},{"name":"tree_plateau","position":[-19.5,0,-8.5],"material":3,"x":4,"y":3},{"name":"tree_plateau","position":[-18.5,0,-8.5],"material":3,"x":5,"y":3},{"name":"tree_plateau","position":[-18.5,0,-4.5],"material":3,"x":5,"y":7},{"name":"tree_plateau","position":[-19.5,0,-4.5],"material":3,"x":4,"y":7},{"name":"tree_plateau","position":[-20.5,0,5.5],"material":2,"x":3,"y":5},{"name":"tree_thin","position":[-20.5,0,1.5],"material":2,"x":3,"y":1},{"name":"stone_large","position":[-21.5,0,8.5],"material":2,"x":2,"y":8},{"name":"pine","position":[-19.5,0,-15.5],"material":4,"x":4,"y":8},{"name":"flower","position":[-20.5,0,-5.5],"material":3,"x":3,"y":6},{"name":"flower","position":[-19.5,0,-9.5],"material":3,"x":4,"y":2},{"name":"flower","position":[-17.5,0,-7.5],"material":3,"x":6,"y":4},{"name":"stone_small","position":[-20.5,0,-4.5],"material":3,"x":3,"y":7},{"name":"stone_small","position":[-20.5,0,-6.5],"material":3,"x":3,"y":5},{"name":"stone_small","position":[-20.5,0,-8.5],"material":3,"x":3,"y":3},{"name":"stone_small","position":[-17.5,0,-6.5],"material":3,"x":6,"y":5},{"name":"stone_small","position":[-17.5,0,-5.5],"material":3,"x":6,"y":6},{"name":"tree_tall_dark","position":[-23.5,0,-10.5],"material":3,"x":0,"y":1},{"name":"tree_thin","position":[-23.5,0,-8.5],"material":3,"x":0,"y":3},{"name":"tree_plateau","position":[-23.5,0,-6.5],"material":3,"x":0,"y":5},{"name":"pine","position":[-23.5,0,-4.5],"material":3,"x":0,"y":7},{"name":"house","position":[-20.5,0,3.5],"material":2,"x":2,"y":2},{"name":"stone_small","position":[-22.5,0,3.5],"material":2,"x":1,"y":3},{"name":"pine","position":[-21.5,0,-2.5],"material":3,"x":2,"y":9},{"name":"pine","position":[-20.5,0,-2.5],"material":3,"x":3,"y":9},{"name":"flower","position":[-17.5,0,6.5],"material":2,"x":6,"y":6},{"name":"flower","position":[-17.5,0,5.5],"material":2,"x":6,"y":5},{"name":"flower","position":[-18.5,0,10.5],"material":2,"x":5,"y":10},{"name":"flower","position":[-18.5,0,9.5],"material":2,"x":5,"y":9},{"name":"cactus","position":[-11.5,0,4.5],"material":1,"x":0,"y":4},{"name":"palm_tree","position":[-7.5,0,5.5],"material":1,"x":4,"y":5},{"name":"tree_thin","position":[-13.5,0,8.5],"material":2,"x":10,"y":8},{"name":"tree_plateau","position":[-15.5,0,10.5],"material":2,"x":8,"y":10},{"name":"stone_small","position":[-14.5,0,5.5],"material":2,"x":9,"y":5},{"name":"flower","position":[-23.5,0,6.5],"material":2,"x":0,"y":6},{"name":"flower","position":[-23.5,0,7.5],"material":2,"x":0,"y":7},{"name":"flower","position":[-21.5,0,10.5],"material":2,"x":2,"y":10},{"name":"flower","position":[-22.5,0,10.5],"material":2,"x":1,"y":10},{"name":"palm_tree","position":[-3.5,0,8.5],"material":1,"x":8,"y":8},{"name":"palm_tree","position":[-7.5,0,9.5],"material":1,"x":4,"y":9},{"name":"flower","position":[-18.5,0,-3.5],"material":3,"x":5,"y":8}]}')},,,function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=.05,r=n*n,a=t?.4:.6,i=t?.75:.5;if(e<n)return r-(e=n-e)*e;if(e<a){var o=a-n;return r+(e-=n)*e*(i-r)/(o*o)}var s=1-a;return 1-(e=1-e)*e*e*(1-i)/(s*s*s)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.type;if("Group"===n){console.log(t+"GROUP",e.name);for(var a=t+"    ",i=e.children,o=0;o<i.length;o++)r(i[o],a)}else"Mesh"===n&&console.log(t+"MESH",e.name)}n.d(t,"a",(function(){return r}))},,,,,,function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=Math.sqrt,i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=n}var t,n,i;return t=e,(n=[{key:"copy",value:function(){return new e(this.x,this.y)}},{key:"add",value:function(e,t){return"number"==typeof e?(this.x+=e,this.y+=t):(this.x+=e.x,this.y+=e.y),this}},{key:"subtract",value:function(e,t){return"number"==typeof e?(this.x-=e,this.y-=t):(this.x-=e.x,this.y-=e.y),this}},{key:"scale",value:function(e){return this.x*=e,this.y*=e,this}},{key:"length",value:function(){var e=this.x,t=this.y;return a(e*e+t*t)}},{key:"norm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.scale(e/this.length())}},{key:"rotateClockwise",value:function(){var e=this.x,t=this.y;return this.x=t,this.y=-e,this}},{key:"rotateCounterClockwise",value:function(){var e=this.x,t=this.y;return this.x=-t,this.y=e,this}},{key:"set",value:function(e,t){"number"==typeof e?(this.x=e,this.y=t):(this.x=e.x,this.y=e.y)}}])&&r(t.prototype,n),i&&r(t,i),e}();t.default=i},,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"td_cx",(function(){return K})),n.d(t,"td_cy",(function(){return ee})),n.d(t,"td_walkable",(function(){return te})),n.d(t,"td_cut0",(function(){return ne})),n.d(t,"td_cut1",(function(){return re})),n.d(t,"td_cut2",(function(){return ae})),n.d(t,"td_cut3",(function(){return ie})),n.d(t,"td_tileId",(function(){return oe})),n.d(t,"td_entropy",(function(){return se})),n.d(t,"td_collapsed",(function(){return le})),n.d(t,"td_ground",(function(){return ue})),n.d(t,"td_bitmask",(function(){return fe})),n.d(t,"td_size",(function(){return ce})),n.d(t,"h_height",(function(){return ye})),n.d(t,"h_ground",(function(){return pe})),n.d(t,"h_cuts",(function(){return be})),n.d(t,"h_size",(function(){return _e}));var r=n(12),a=n.n(r),i=n(32),o=n(33),s=n.n(o),l=(n(11),n(10)),u=n.n(l),f=n(0),c=n(1),d=n.n(c),h=n(7),v=(n(34),n(13)),m=n(14),g=(n(36),new f.vb),y=n(20),p=n(3),b=n(6),_=n(9),w=n(21),x=n(5),O=n(17);function j(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var P,S,A=[1,.95,.5,.2,.98,1,1,1];var z,k,E,T,I=new Uint8Array(x.c);function C(e,t,n,r,a,i){for(var o=a+1,s=0,l=0,u=0;u<r;u++)for(var f=e[t+fe+u],c=1,d=0;c;){if(f&c){var h=i*o+1+d;s+=n[h],l+=S[h]}c<<=1,d++}return Math.log2(s)-l/s}function F(e,t,n,r){var a=e.tiles,i=Object(b.b)(r),o=i+31>>5,s=i+1,l=c.t_size/ce,u=ce/c.t_size;if(!P){var f=P=Object(_.a)(O,12,r,A),d=f.weights,h=f.adjacencies;console.log("weights",j(d),"adjacencies",j(h)),S=function(e,t){for(var n=Object(b.b)(e),r=n+1,a=new Float64Array(t),i=0;i<x.c;i++)for(var o=i*r+1,s=0;s<n;s++){var l=t[o+s];l>0&&(a[o+s]=Math.log2(l)*l)}return a}(r,P.weights),k=function(e,t){for(var n=new Uint8Array(e),r=0;r<t.length;r++){var a=t[r],i=a.id,o=a.idCount;if(a.reachable)for(var s=0;s<o;s++)n[i+s]=1}return n}(i,r)}var v=P,m=v.weights,g=v.adjacencies;!function(e,t,n,r){var a=P,i=a.weights,o=a.adjacencies,s=_e/c.g_size,l=ce/c.t_size,u=Object(b.b)(r),f=u+31>>5,d=u+1;if(fe+f>ce)throw new Error("more td_bitmaskN values needed");z||(z=new Uint32Array(f));for(var h=I.length,v=0,m=0;m<e.length;m+=c.t_size){var g=e[m+c.t_n0]*s,y=e[m+c.t_n1]*s,_=e[m+c.t_n2]*s,w=e[m+c.t_n3]*s;I.fill(0),I[t[g+pe]]++,I[t[y+pe]]++,I[t[_+pe]]++,I[t[w+pe]]++;for(var x=0,O=-1,j=0;j<h;j++){I[j]>x&&(x=I[j],O=j)}if(n[v+ue]=O,O===p.e||O===p.l)n[v+oe]=0,n[v+le]=1;else{for(var M=!1,S=0;S<4;S++){var A=e[m+c.t_tile0+S];if(A>=0)if(n[A*l+le]){M=!0;break}}for(var k=O*d*f,E=O*d*f+u*f,T=0;T<f;T++)n[v+fe+T]=M?o[k+T]:o[E+T];n[v+se]=C(n,v,i,f,u,O)}v+=ce}}(a,t,n,r);var y,w,M,F=!1,L=a.length/c.t_size;(!E||E.length<L)&&(E=new Float64Array(L+1|0)),(!T||T.length<i)&&(T=new Uint32Array(2*i));do{y=0;for(var D=1/0,R=0;R<n.length;R+=ce)if(!n[R+le]){var B=n[R+se];B<D?(D=B,E[0]=R,y=1):B===D&&(E[y++]=R)}if(D===1/0)return;var N=void 0,U=null,W=0,Z=n[(N=1===y?E[0]:E[Math.random()*y|0])+ue];w=0,M=0;for(var G=0;G<o;G++)for(var H=n[N+fe+G],X=1;X;){if(H&X&&(n[N+te]||!k[W])){var q=m[Z*s+1+W];T[w++]=q,T[w++]=W,M+=q}X<<=1,W++}if(2===w)U=T[1];else for(var Y=Math.random()*M|0,$=0;$<w;$+=2){var J=T[$],Q=T[$+1];if((Y-=J)<=0){U=Q;break}}n[N+oe]=U,n[N+le]=1,F=!0,L--;for(var V=N*l,K=0;K<4;K++){var ee=a[V+c.t_tile0+K];if(!(ee<0)){var ne=ee*u;if(!n[ne+le]){for(var re=n[ne+ue],ae=!0,ie=0;ie<4;ie++){var de=a[ee+c.t_tile0+ie];if(!(de<0)){var he=de*u,ve=n[he+le],me=n[he+oe];if(ve&&-1!==me){var ge=me>>5,ye=1<<me-(ge<<5);if(!(g[re*s+i+ge]&ye))continue;for(var be=0;be<o;be++){var we=g[re*s+me+be];ae?n[he+fe+be]=we:n[ne+fe+be]&=we}ae=!1}}}for(var xe=!0,Oe=0;Oe<o;Oe++)if(n[ne+fe+Oe]){xe=!1;break}xe?(n[ne+oe]=0,n[ne+le]=1):n[ne+se]=C(n,ne,m,o,i,re)}}}}while(F&&L>0)}var L=/^(#)?([0-9a-f]+)$/i;function D(e){var t;if("string"!=typeof e||!(t=L.exec(e)))return null;var n=t[2];return 3===n.length?{r:parseInt(n[0],16)/15,g:parseInt(n[1],16)/15,b:parseInt(n[2],16)/15}:6===n.length?{r:parseInt(n.substring(0,2),16)/255,g:parseInt(n.substring(2,4),16)/255,b:parseInt(n.substring(4,6),16)/255}:null}function R(e){var t=D(e);if(!t)throw new Error("Invalid color "+e);return t}function B(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||N(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){if(e){if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(e,t):void 0}}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var W,Z,G,H,X,q,Y,$,J,Q,V,K=0,ee=1,te=2,ne=3,re=4,ae=5,ie=6,oe=7,se=8,le=9,ue=10,fe=11,ce=12;var de=10*Math.random();Math.random();function he(e,t){var n=Math.sqrt(e*e+t*t),r=Object(y.a)(1-n/750,0);return Math.max(0,(62.5+62.5*(.99*je.noise2D(de+.003*e,.003*t)+je.noise2D(.07*t,.07*e)*(1-.99)+0))*r)}var ve=new Float64Array(5);function me(){for(var e=V,t=(e.graph,e.tiles),n=t.length,r=ce/c.t_size,a=[],i=new Set,o=0;o<n;o+=c.t_size){var s=o*r,l=t[o+c.t_tile0]*r,u=t[o+c.t_tile1]*r,f=t[o+c.t_tile2]*r,d=t[o+c.t_tile3]*r;ve[0]=he($[s],$[s+1]),ve[1]=l>=0?he($[l+K],$[l+ee]):-1,ve[2]=u>=0?he($[u+K],$[u+ee]):-1,ve[3]=f>=0?he($[f+K],$[f+ee]):-1,ve[4]=d>=0?he($[d+K],$[d+ee]):-1;var h=0;if(l>=0&&Math.abs(ve[0]-ve[1])>7&&(h|=1),u>=0&&Math.abs(ve[0]-ve[2])>7&&(h|=2),f>=0&&Math.abs(ve[0]-ve[3])>7&&(h|=4),d>=0&&Math.abs(ve[0]-ve[4])>7&&(h|=8),0!==h){for(var v=0;v<4;v++)if(h&1<<v){var m=v,g=3===v?0:v+1,y=t[o+c.t_n0+m]*Te,b=t[o+c.t_n0+g]*Te,_=ve[0],w=t[o+c.t_n0+m],x=t[o+c.t_n0+g];i.add(w),i.add(x),$[s+ne+m]=_,$[s+ne+g]=_;var O=Math.random();O<.2?J[y+pe]=p.i:O<.4&&(J[b+pe]=p.i);var j=t[o+c.t_tile0+v];t[o+c.t_tile0+v]=-1;for(var M=-1,P=0;P<4;P++)if(t[j+c.t_tile0+P]===o&&-1===$[j*r+ne+P]){M=o;break}-1!==M&&a.push(0,o,j,m,g)}for(var S=0;S<4;S++)if(!(h&1<<S)){var A=3===S?0:S+1,z=h&1<<(0===S?3:S-1),k=h&1<<A,E=t[o+c.t_tile0+S];(z||k)&&(z&&k?a.push(0,o,E,S,A):z?a.push(2,o,E,S,A):a.push(1,o,E,S,A))}}}var T,I=new Set,C=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=N(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a,i=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw a}}}}(i);try{for(C.s();!(T=C.n()).done;)for(var F=T.value,L=0;L<n;L+=c.t_size)for(var D=0;D<4;D++){if(t[L+c.t_n0+D]===F){var R=L*r;I.add(L),-1===$[R+ne+D]&&($[R+ne+D]=he($[R+K],$[R+ee]))}}}catch(e){C.e(e)}finally{C.f()}return console.log("Tiles cut:",I.size," of ",$.length/ce),{tileCuts:a,cutTiles:I}}var ge,ye=0,pe=1,be=2,_e=3;function we(){qe=u()();var e=V=new d.a({numberOfRings:15,width:1500,height:1500,minTension:10}),t=e.graph,n=(e.tiles,e.config,t.length),r=_e/c.g_size;J=new Float64Array(n*r);for(var a=0,i=0;i<n;i+=c.g_size)J[a+ye]=he(t[i+c.g_x],t[i+c.g_y]),J[a+pe]=p.k,a+=_e;$=new Float64Array(V.tiles.length/c.t_size*ce),function(){for(var e=V,t=e.graph,n=e.tiles,r=n.length,a=0,i=0;i<r;i+=c.t_size){var o=n[i+c.t_n0],s=n[i+c.t_n1],l=n[i+c.t_n2],u=n[i+c.t_n3];$[a+K]=(t[o+c.g_x]+t[s+c.g_x]+t[l+c.g_x]+t[u+c.g_x])/4,$[a+ee]=(t[o+c.g_y]+t[s+c.g_y]+t[l+c.g_y]+t[u+c.g_y])/4,$[a+te]=0,$[a+ne]=-1,$[a+re]=-1,$[a+ae]=-1,$[a+ie]=-1,a+=ce}}();var o=me(),s=o.cutTiles,l=o.tileCuts;ge=l,function(){for(var e=V.graph,t=e.length,n=0,r=0,a=0;a<t;a+=c.g_size){var i=e[r+c.g_x],o=J[n+ye],s=e[r+c.g_y];if(J[n+pe]===p.k)if(o<2)J[n+pe]=p.l;else if(o<6.5)J[n+pe]=p.h;else{var l=je.noise2D(.005*i,.005*s);J[n+pe]=o<60?l<.2?p.d:p.c:l<.2?p.c:p.d}n+=_e,r+=c.g_size}}(),function(e){var t=function(){for(var e=V.tiles,t=e.length,n=0;n<t;n+=c.t_size)if(e[n+c.t_isEdge])return n;throw new Error("No edge!?")}();console.log("Starting to walk at #",t/c.t_size);var n=new Set;!function e(t,n,r){if(t>=0&&!n.has(t)){if(r.has(t))return;n.add(t);var a=V.tiles;$[t*xe+te]=1,e(a[t+c.t_tile0],n,r),e(a[t+c.t_tile1],n,r),e(a[t+c.t_tile2],n,r),e(a[t+c.t_tile3],n,r)}}(t,n,e)}(s)}var xe=ce/c.t_size;var Oe=new i.a("TEST"),je=new s.a((function(){return Oe.next()}));R("#f0f");var Me,Pe,Se=1e3,Ae=.1,ze=.1;function ke(){if(Pe){var e=Math.PI*(Ae-.5),t=2*Math.PI*(ze-.5);X.position.x=Se*Math.cos(t),X.position.y=Se*Math.sin(t)*Math.sin(e),X.position.z=Se*Math.sin(t)*Math.cos(e),Pe.material.uniforms.sunPosition.value=X.position.copy(X.position),Y&&Y.material.uniforms.sunDirection.value.copy(X.position).normalize(),Me.update(H,Pe)}}function Ee(){we(),W=document.getElementById("container"),(H=new f.Fb).setPixelRatio(window.devicePixelRatio),H.setSize(window.innerWidth,window.innerHeight),H.outputEncoding=f.Gb,W.appendChild(H.domElement),G=new f.mb,(Z=new f.Z(55,window.innerWidth/window.innerHeight,1,2e4)).position.set(250,250,1e3),X=new f.l("#fff8d5",.8),G.add(X),Me=new f.j(.2,1,512),G.background=Me.renderTarget;var e=new f.bb(3e4,3e4),t=new f.Q({side:f.q,color:"#00232a",envMap:Me.renderTarget.texture,roughness:.2});new f.N(e,t).rotation.x=-Math.PI/2,Pe=new v.a,Me.renderTarget.texture,ke(),(q=new m.a(Z,H.domElement)).maxPolarAngle=Math.PI,q.target.set(0,0,0),q.minDistance=0,q.maxDistance=1500,q.enableDamping=!0,q.dampingFactor=.02,q.update(),window.addEventListener("resize",Ze,!1);var n=Object(b.a)(null);Ye=u()(),F(V,J,$,n),$e=u()(),function(e){for(var t=new Map,n=0,r=[],a=[],i=[],o=function(e,o,s,l,u,f,c,d){var h=(e=Math.round(16*e)/16)+","+(o=Math.round(16*o)/16)+","+(s=Math.round(16*s)/16)+"/"+(l=Math.round(1024*l)/1024)+","+(u=Math.round(1024*u)/1024)+","+(f=Math.round(1024*f)/1024)+"/"+(c=Math.round(4096*c)/4096)+","+(d=Math.round(4096*d)/4096),v=t.get(h);if(void 0===v){var m=n++;return t.set(h,m),r.push(e,o,s),a.push(c,d),i.push(l,u,f),m}return v},s=new Array(7),l=p.l+1;l<7;l++){var u=We(l,o,e);u.length&&(s[l]=u)}var d=V,h=d.graph,v=d.tiles,m=s[p.i];m||(m=s[p.i]=[]);for(var g=0;g<ge.length;g+=5){for(var y=ge[g+0],b=ge[g+1],_=ge[g+2],w=ge[g+3],x=ge[g+4],O=b*xe,j=_*xe,M=-1,P=-1,S=v[b+c.t_n0+w],A=v[b+c.t_n0+x],z=0;z<4;z++)if(v[_+c.t_n0+z]===S){if(M=z,-1!==P)break}else if(v[_+c.t_n0+z]===A&&(P=z,-1!==M))break;if(-1!==M&&-1!==P){var k=h[S+c.g_x],E=$[O+ne+w],T=h[S+c.g_y],I=h[A+c.g_x],C=$[O+ne+x],F=h[A+c.g_y],L=k,D=$[j+ne+M],R=T,B=I,N=$[j+ne+P],U=F;switch(y){case 0:var W=k-I,Z=E-C,H=T-F,X=B-I,q=N-C,Y=U-F,J=Z*Y-H*q,K=H*X-W*Y,ee=W*q-Z*X,te=o(k,E,T,J,K,ee,0,0),re=o(I,C,F,J,K,ee,0,1),ae=o(B,N,U,J,K,ee,1,1),ie=o(L,D,R,J,K,ee,1,0);m.push(re,te,ae),m.push(ae,te,ie);break;case 1:var oe=k-I,se=E-C,le=T-F,ue=B-I,fe=N-C,ce=U-F,de=se*ce-le*fe,he=le*ue-oe*ce,ve=oe*fe-se*ue,me=o(k,E,T,de,he,ve,0,0),ye=o(I,C,F,de,he,ve,0,1),pe=o(B,N,U,de,he,ve,1,1);m.push(me,ye,pe);break;case 2:var be=k-L,_e=E-D,we=T-R,Oe=B-L,je=N-D,Me=U-R,Pe=_e*Me-we*je,Se=we*Oe-be*Me,Ae=be*je-_e*Oe,ze=o(k,E,T,Pe,Se,Ae,0,0),ke=o(B,N,U,Pe,Se,Ae,1,1),Ee=o(L,D,R,Pe,Se,Ae,1,0);m.push(ze,ke,Ee)}}else console.log("No two cuts for",b,_,"=>",M,P)}var Te=new f.g;Te.setAttribute("position",new f.f(new Float32Array(r),3,!1)),Te.setAttribute("normal",new f.f(new Float32Array(i),3,!1)),Te.setAttribute("uv",new f.f(new Float32Array(a),2,!1));for(var Ie=0,Ce=[],Fe=[],Le=0;Le<s.length;Le++){var De=s[Le];if(De){Fe=Fe.concat(De);var Re=De.length;Te.addGroup(Ie,Re,Ce.length),Ce.push(Q[Le].clone()),Ie+=Re}}Te.setIndex(Fe);var Be=new f.N(Te,Ce);G.add(Be)}(He)}new f.W;var Te=_e/c.g_size,Ie=new f.Bb,Ce=new f.Bb,Fe=new f.Bb,Le=new f.Bb,De=new f.Bb,Re=new f.Bb,Be=new f.Bb,Ne=new f.Bb,Ue=new f.Bb;function We(e,t,n){for(var r=V,a=r.graph,i=r.tiles,o=i.length,s=[],l=0,u=0;u<o;u+=c.t_size){var f=i[u+c.t_n0],d=i[u+c.t_n1],h=i[u+c.t_n2],v=i[u+c.t_n3],m=f*Te,g=d*Te,y=h*Te,b=v*Te,_=a[f+c.g_x],w=-1===$[l+ne]?J[m+ye]:$[l+ne],x=a[f+c.g_y],O=a[d+c.g_x],j=-1===$[l+re]?J[g+ye]:$[l+re],M=a[d+c.g_y],P=a[h+c.g_x],S=-1===$[l+ae]?J[y+ye]:$[l+ae],A=a[h+c.g_y],z=a[v+c.g_x],k=-1===$[l+ie]?J[b+ye]:$[l+ie],E=a[v+c.g_y],T=_-O,I=w-j,C=x-M,F=P-O,L=S-j,D=A-M,R=z-O,B=k-j,N=E-M,U=(I*D-C*L+(I*N-C*B))/3,W=(C*F-T*D+(C*R-T*N)+1)/3,Z=(T*L-I*F+(T*B-I*R))/3,G=1/Math.sqrt(U*U+W*W+Z*Z);U*=G,W*=G,Z*=G;var H=J[m+pe],X=J[b+pe],q=J[y+pe],Y=J[g+pe],Q=(H===e?1:0)+(X===e?2:0)+(q===e?4:0)+(Y===e?8:0);if(0!==Q){1===Q&&X!==Y?Q=16:2===Q&&q!==H?Q=17:4===Q&&Y!==X?Q=18:8===Q&&H!==q&&(Q=19),5!==Q||H!==p.d&&H!==p.i||(Q=20),10!==Q||X!==p.d&&X!==p.i||(Q=21),Ie.set(_,w,x),Ce.set(z-_,k-w,E-x),Fe.set(P-O,S-j,A-M),Le.set(O-_,j-w,M-x);for(var K=n[Q],ee=K.getIndex().array,te=K.getAttribute("position").array,oe=K.getAttribute("uv").array,se=K.getAttribute("normal").array,le=0;le<ee.length;le++){var ue=ee[le],fe=3*ue,de=2*ue,he=1.01*(te[fe]+.5),ve=1.01*(te[fe+1]+.5),me=1.01*(te[fe+2]+.5),ge=se[fe],be=se[fe+1],_e=se[fe+2];De.copy(Ce).multiplyScalar(he).add(Ie),Re.copy(Fe).multiplyScalar(he).add(Ie).add(Le),Ue.set(U,W,Z).multiplyScalar(me),Be.copy(Re).sub(De).multiplyScalar(ve).add(De).add(Ue),De.copy(Ce).multiplyScalar(he+ge).add(Ie),Re.copy(Fe).multiplyScalar(he+ge).add(Ie).add(Le),Ue.set(U,W,Z).multiplyScalar(me+_e),Ne.copy(Re).sub(De).multiplyScalar(ve+be).add(De).add(Ue),Ne.sub(Be).normalize(),s.push(t(Be.x,Be.y,Be.z,Ne.x,Ne.y,Ne.z,oe[de],oe[de+1]))}}l+=ce}return s}function Ze(){Z.aspect=window.innerWidth/window.innerHeight,Z.updateProjectionMatrix(),H.setSize(window.innerWidth,window.innerHeight)}function Ge(){!function(){var e=1e-4*performance.now();Y&&(Y.position.y=1.9+.4*Math.sin(e),Y.material.uniforms.time.value+=1/60);H.render(G,Z);!1}(),ke(),q.update(),a()(Ge)}var He,Xe,qe,Ye,$e;Promise.all([Object(h.a)("assets/tiles.glb"),Object(h.a)("assets/ground.glb"),Object(h.a)("assets/ms.glb"),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,r){g.load(e,n,t,r)}))}("assets/waternormals.jpg")]).then((function(e){var t=B(e,4),n=(t[0],t[1]),r=t[2],a=t[3];Xe=u()(),Object(w.a)(n.scene,"tiles: "),Q=p.f.map((function(e){return n.scene.children.find((function(t){return t.name===e})).material})),He=function(e){for(var t=e.children,n=new Array(p.a.length),r=0;r<t.length;r++){var a=t[r],i=p.a.indexOf(a.name);i>=0&&(n[i]=a.geometry)}return n}(r.scene),a.wrapS=a.wrapT=f.lb,a,Ee();var i=u()();console.log("Init: ",qe-Xe,"ms"),console.log("Organic Quads: ",$e-qe,"ms"),console.log("WFC: ",$e-Ye,"ms"),console.log("geo: ",i-$e,"ms"),console.log("Total: ",i-Xe,"ms"),Ge()}))}]).default;
//# sourceMappingURL=bundle-main-2e918132ac2e9092dd9c.js.map