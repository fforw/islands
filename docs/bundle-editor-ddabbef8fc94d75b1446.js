var App=function(e){function t(t){for(var i,o,l=t[0],s=t[1],c=t[2],f=0,m=[];f<l.length;f++)o=l[f],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&m.push(r[o][0]),r[o]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);for(u&&u(t);m.length;)m.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,l=1;l<n.length;l++){var s=n[l];0!==r[s]&&(i=!1)}i&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},r={1:0},a=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var l=window.webpackJsonpApp=window.webpackJsonpApp||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;return a.push([45,0]),n()}({10:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(0);function r(e,t,n,r){return new Promise((function(a){var o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.top="0px",o.style.left="-10000px";var l=new i.Ab({alpha:!0});l.setPixelRatio(window.devicePixelRatio),l.setSize(t,n),o.appendChild(l.domElement);var s=new i.hb,c=new i.U(55,t/n,.1,100),u=new i.k("#fff8d5",1.4);u.position.set(0,3,-1.5),s.add(u);for(var f,m=[],d=0;d<e.length;d++){f&&s.remove(f),f=e[d].clone();var p=new i.d;p.expandByObject(f);var v=Math.max(p.max.x-p.min.x,p.max.y-p.min.y),y=v<1.5,b=y?1.2*Math.pow(v,.9):1.5*v;c.up.set(0,1,0),c.position.set(0,p.max.y*(y?1.1:.9),-b),c.lookAt(new i.wb(0,(p.max.y+p.min.y)/(y?2:4),0)),c.updateProjectionMatrix(),f.position.set(0,0,0),s.add(f),l.render(s,c);var h=document.createElement("canvas");h.width=t,h.height=n;var w=h.getContext("2d");w.drawImage(l.domElement,0,0),w.strokeStyle="rgba(255,255,255,0.4)",w.fillStyle="#fff",w.lineWidth=2,w.beginPath(),w.rect(0,0,t,n),w.stroke();var g=r?r[d]:f.name;w.fillText(g,4,n-4),m.push(h)}a(m),s.dispose(),l.dispose(),document.body.removeChild(o)}))}},11:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(4),r=(n(0),n(2));function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=0,l=function(){function e(t,n,i,r,a,l,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=void 0,this.tile=void 0,this.position=void 0,this.object=null,this.indexes=null,this.id=++o,this.scene=t,this.tile=n,this.position=i.clone(),this.rotation=r,this.material=a,this.x=l,this.y=s,t&&this.createObject()}var t,n,l;return t=e,(n=[{key:"createObject",value:function(){var e=this.tile,t=this.scene,n=this.position,a=this.rotation,o=e.variants;this.variant=Math.random()*o.length|0;var l=o[this.variant].clone();l.scale.set(i.a,i.a,i.a),l.position.copy(n),l.rotation.y=r.j*a/4,this.object=l,t.add(l)}},{key:"removeObject",value:function(){var e=this.scene,t=this.object;t&&(e.remove(t),this.object=null)}}])&&a(t.prototype,n),l&&a(t,l),e}()},12:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(11),r=n(0);function a(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i.name===t)return i}return null}function o(e,t,n,o,l){for(var s=e.instances,c=new Set,u=0;u<s.length;u++){var f=s[u],m=a(t,f.name);if(m){var d=new i.a(l,m,new r.wb(f.position[0],f.position[1],f.position[2]),4*Math.random()|0,f.material,f.x,f.y);d.variant=Math.random()*m.variants.length|0,d.indexes=n.setTile(d.material,d.x,d.y,d.tile,d.rotation,!0),o&&o.add(d)}else c.add(f.name)}c.size>0&&console.log("Could not find some tiles: ",c)}},14:function(e){e.exports=JSON.parse('{"version":1,"timestamp":"2020-06-14T22:28:21.741Z","instances":[{"name":"stone_small","position":[-1.5,0,3.5],"material":1,"x":10,"y":3},{"name":"stone_small","position":[-18.5,0,-18.5],"material":4,"x":5,"y":5},{"name":"stone_small","position":[-18.5,0,-17.5],"material":4,"x":5,"y":6},{"name":"stone_large","position":[-20.5,0,-19.5],"material":4,"x":3,"y":4},{"name":"stone_large","position":[-20.5,0,-18.5],"material":4,"x":3,"y":5},{"name":"tree_thin","position":[-18.5,0,-7.5],"material":3,"x":5,"y":4},{"name":"tree_thin","position":[-18.5,0,-6.5],"material":3,"x":5,"y":5},{"name":"tree_tall_dark","position":[-19.5,0,-7.5],"material":3,"x":4,"y":4},{"name":"tree_tall_dark","position":[-19.5,0,-6.5],"material":3,"x":4,"y":5},{"name":"pine","position":[-18.5,0,-5.5],"material":3,"x":5,"y":6},{"name":"pine","position":[-19.5,0,-5.5],"material":3,"x":4,"y":6},{"name":"tree_plateau","position":[-19.5,0,-8.5],"material":3,"x":4,"y":3},{"name":"tree_plateau","position":[-18.5,0,-8.5],"material":3,"x":5,"y":3},{"name":"tree_plateau","position":[-18.5,0,-4.5],"material":3,"x":5,"y":7},{"name":"tree_plateau","position":[-19.5,0,-4.5],"material":3,"x":4,"y":7},{"name":"flower","position":[-14.5,0,1.5],"material":2,"x":9,"y":1},{"name":"flower","position":[-14.5,0,2.5],"material":2,"x":9,"y":2},{"name":"tree_plateau","position":[-20.5,0,5.5],"material":2,"x":3,"y":5},{"name":"tree_thin","position":[-20.5,0,1.5],"material":2,"x":3,"y":1},{"name":"stone_small","position":[-13.5,0,-4.5],"material":3,"x":10,"y":7},{"name":"stone_large","position":[-21.5,0,8.5],"material":2,"x":2,"y":8},{"name":"pine","position":[-19.5,0,-15.5],"material":4,"x":4,"y":8},{"name":"flower","position":[-18.5,0,-3.5],"material":3,"x":5,"y":8},{"name":"flower","position":[-20.5,0,-5.5],"material":3,"x":3,"y":6},{"name":"flower","position":[-20.5,0,-7.5],"material":3,"x":3,"y":4},{"name":"flower","position":[-19.5,0,-9.5],"material":3,"x":4,"y":2},{"name":"flower","position":[-17.5,0,-7.5],"material":3,"x":6,"y":4},{"name":"stone_small","position":[-20.5,0,-4.5],"material":3,"x":3,"y":7},{"name":"stone_small","position":[-20.5,0,-6.5],"material":3,"x":3,"y":5},{"name":"stone_small","position":[-20.5,0,-8.5],"material":3,"x":3,"y":3},{"name":"stone_small","position":[-18.5,0,-9.5],"material":3,"x":5,"y":2},{"name":"stone_small","position":[-17.5,0,-6.5],"material":3,"x":6,"y":5},{"name":"stone_small","position":[-17.5,0,-5.5],"material":3,"x":6,"y":6},{"name":"tree_tall_dark","position":[-23.5,0,-10.5],"material":3,"x":0,"y":1},{"name":"tree_thin","position":[-23.5,0,-8.5],"material":3,"x":0,"y":3},{"name":"tree_plateau","position":[-23.5,0,-6.5],"material":3,"x":0,"y":5},{"name":"pine","position":[-23.5,0,-4.5],"material":3,"x":0,"y":7},{"name":"house","position":[-20.5,0,3.5],"material":2,"x":2,"y":2},{"name":"stone_small","position":[-22.5,0,3.5],"material":2,"x":1,"y":3},{"name":"pine","position":[-21.5,0,-2.5],"material":3,"x":2,"y":9},{"name":"pine","position":[-20.5,0,-2.5],"material":3,"x":3,"y":9},{"name":"flower","position":[-17.5,0,6.5],"material":2,"x":6,"y":6},{"name":"flower","position":[-17.5,0,5.5],"material":2,"x":6,"y":5},{"name":"flower","position":[-16.5,0,1.5],"material":2,"x":7,"y":1},{"name":"flower","position":[-17.5,0,1.5],"material":2,"x":6,"y":1},{"name":"flower","position":[-18.5,0,10.5],"material":2,"x":5,"y":10},{"name":"flower","position":[-18.5,0,9.5],"material":2,"x":5,"y":9},{"name":"cactus","position":[-11.5,0,4.5],"material":1,"x":0,"y":4},{"name":"palm_tree","position":[-7.5,0,5.5],"material":1,"x":4,"y":5},{"name":"tree_thin","position":[-13.5,0,8.5],"material":2,"x":10,"y":8},{"name":"tree_plateau","position":[-15.5,0,10.5],"material":2,"x":8,"y":10},{"name":"stone_small","position":[-14.5,0,5.5],"material":2,"x":9,"y":5},{"name":"flower","position":[-23.5,0,6.5],"material":2,"x":0,"y":6},{"name":"flower","position":[-23.5,0,7.5],"material":2,"x":0,"y":7},{"name":"flower","position":[-21.5,0,10.5],"material":2,"x":2,"y":10},{"name":"flower","position":[-22.5,0,10.5],"material":2,"x":1,"y":10},{"name":"palm_tree","position":[-3.5,0,8.5],"material":1,"x":8,"y":8},{"name":"palm_tree","position":[-7.5,0,9.5],"material":1,"x":4,"y":9}]}')},2:function(e,t,n){"use strict";var i,r;function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"l",(function(){return o})),n.d(t,"h",(function(){return l})),n.d(t,"d",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"i",(function(){return u})),n.d(t,"e",(function(){return f})),n.d(t,"b",(function(){return m})),n.d(t,"k",(function(){return d})),n.d(t,"f",(function(){return p})),n.d(t,"a",(function(){return v})),n.d(t,"j",(function(){return y})),n.d(t,"g",(function(){return b}));var o=0,l=1,s=2,c=3,u=4,f=5,m=6,d=8,p=["Water","Sand","Grass","Forest","Stone","Ice","Dirt","Packed_Ice"],v=[null,"case-1","case-2","case-3","case-4","case-5-1","case-6","case-7","case-8","case-9","case-10-1","case-11","case-12","case-13","case-14","case-15","case-m1","case-m2","case-m3","case-m4","case-5-2","case-10-2"],y=(a(i={},o,[0,.4,.8]),a(i,l,[.8,.8,0]),a(i,s,[0,.7,0]),a(i,m,[.5,.3,.1]),a(i,c,[.2,.5,.3]),a(i,u,[.5,.5,.5]),a(i,f,[1,1,1]),a(i,7,[1,1,1]),a(i,d,[1,0,1]),a(r={},o,0),a(r,l,1),a(r,s,1),a(r,m,1),a(r,c,1),a(r,u,.4),a(r,f,.9),a(r,7,.8),a(r,d,0),2*Math.PI),b=(1+Math.sqrt(5))/2},37:function(e,t,n){},4:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return l})),n.d(t,"b",(function(){return s}));var i=n(0),r=n(2);n(8);function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=1,l=r.b,s=function(){function e(t,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=n,this.size=t,this.data=new Float64Array(t*t*l);var s=new Float64Array(2*l);this.offsets=s;var c=-t*o/2,u=-t*o/2,f=0,m=t*o,d=0,p=1,v=p,y=!1,b=new i.q;b.name="MaterialGrid";for(var h=0;h<l;h++){if(s[d++]=c,s[d++]=u,n){var w=new i.W(o*t,o*t,1,1),g=a[h].clone();g.side=i.l;var x=new i.J(w,g);x.name="M"+h,x.position.set(c,u,0),b.add(x)}if(c+=f,u+=m,0==--v){var j=f;f=-m,m=j,y&&p++,y=!y,v=p}}b.rotation.x=r.j/4,n&&(this.group=b,n.add(b))}var t,n,s;return t=e,(n=[{key:"setTile",value:function(e,t,n,i,r){for(var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=this.size,l=i.sizeX,s=i.sizeZ,f=2*r,m=t+c[f]*(l-1),d=n+c[f+1]*(s-1),p=u[f],v=u[f+1],y=e*o*o,b=!a,h=!b&&new Uint32Array(l*s),w=-p*l-v,g=-v*s+p,x=0,j=0;j<s;j++){for(var O=0;O<l;O++){var _=y+m+d*o,E=i.pattern[j*l+O];b?this.data[_]===E&&(this.data[_]=0):(this.data[_]!==E&&"function"==typeof a&&a(_),h[x++]=_,this.data[_]=E),m+=p,d+=v}m+=w,d+=g}return h}},{key:"clearTile",value:function(e){this.setTile(e.material,e.x,e.y,e.tile,e.rotation,null)}}])&&a(t.prototype,n),s&&a(t,s),e}(),c=[0,0,1,0,1,1,0,1],u=[1,0,0,1,-1,0,0,-1]},45:function(e,t,n){"use strict";n.r(t);var i,r,a,o,l,s,c,u=n(13),f=n.n(u),m=n(3),d=n.n(m),p=n(24),v=n.n(p),y=(n(9),n(0)),b=n(7),h=n(2),w=n(4),g=n(20),x=n(17),j=n(18),O=n.n(j),_=(n(37),n(30)),E=function(e){var t=e.elem,n=e.index,i=e.active,r=e.onClick,a=Object(m.useRef)(null);return Object(m.useEffect)((function(){a.current.appendChild(t)}),[]),d.a.createElement("button",{ref:a,type:"button",className:O()("btn btn-sm m-1",i===n?"btn-light":"btn-default"),onClick:r})},T=Object(m.memo)((function(e){var t=e.sizeX,n=e.sizeY;return d.a.createElement("span",{className:"badge badge-secondary ml-1",style:{visibility:1===t&&1===n&&"hidden"}},t+"x"+n)})),P=Object(_.a)((function(e){var t=e.editorState,n=e.download,i=e.clearAll,r=e.undo,a=e.canUndo,o=e.redo,l=e.canRedo,s=t.tiles,c=t.visible,u=t.activeTileIndex,f=t.activeTile,m=t.dirty;return d.a.createElement(d.a.Fragment,null,d.a.createElement("button",{type:"button",accessKey:"u",className:O()("btn btn-default toggle",c&&"visible"),onClick:function(){return t.toggleVisible()}},d.a.createElement("i",{className:"fas fa-arrows-alt-h"})),d.a.createElement("div",{className:O()("sidebar",c&&"visible"),onFocusCapture:function(){return t.toggleVisible(!0)}},d.a.createElement("div",{className:"container"},d.a.createElement("div",{className:"row"},d.a.createElement("div",{className:"col"},d.a.createElement("p",{className:"form-control-plaintext border-bottom"},d.a.createElement("strong",null,"Island Rules Builder")))),d.a.createElement("div",{className:"row small"},d.a.createElement("div",{className:"col"},d.a.createElement("strong",null,"Selected:"),"Â ",f.name,d.a.createElement(T,{sizeX:f.sizeX,sizeY:f.sizeZ}))),d.a.createElement("div",{className:"row"},d.a.createElement("div",{className:"col"},d.a.createElement("button",{type:"button",className:"btn btn-sm btn-secondary mr-1 mb-1",disabled:!a(),onClick:r},d.a.createElement("i",{className:"fas fa-undo mr-1"}),"Undo"),d.a.createElement("button",{type:"button",className:"btn btn-sm btn-secondary mr-1 mb-1",disabled:!l(),onClick:o},d.a.createElement("i",{className:"fas fa-redo mr-1"}),"Redo"))),d.a.createElement("div",{className:"row"},d.a.createElement("div",{className:"tile-selector flex"},s.map((function(e,n){return d.a.createElement(E,{key:n,index:n,active:u,onClick:function(){return t.selectTile(n)},elem:e.thumbnail})})))),d.a.createElement("div",{className:"row"},d.a.createElement("div",{className:"col"},d.a.createElement("i",{className:O()("fas mr-1",m?"fa-spinner rotating":"fa-check",m?"text-muted":"text-success"),title:m?"Write pending":"Synched to localStorage"}),d.a.createElement("button",{type:"button",className:"btn btn-sm btn-secondary mr-1 mb-1",onClick:n},"Download JSON"),d.a.createElement("button",{type:"button",className:"btn btn-sm btn-danger mr-1 mb-1",onClick:function(){confirm("Do you really want to delete all tiles?")&&i()}},"Clear"))))))})),z=n(5);function k(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function C(e,t,n,i,r){var a={};return Object.keys(i).forEach((function(e){a[e]=i[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),a),r&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(r):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}var A=(i=z.action.bound,a=C((r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),k(this,"visible",a,this),k(this,"dirty",o,this),k(this,"historyPos",l,this),k(this,"historyEnd",s,this),k(this,"activeTileIndex",c,this),this.tiles=t}var t,n,i;return t=e,(n=[{key:"toggleVisible",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.visible;this.visible=e}},{key:"updateHistory",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.historyPos=e,null!==t&&(this.historyEnd=t)}},{key:"selectTile",value:function(e){this.activeTileIndex=e}},{key:"setDirty",value:function(e){this.dirty=e}},{key:"activeTile",get:function(){var e=this.activeTileIndex;return this.tiles[e]}}])&&S(t.prototype,n),i&&S(t,i),e}()).prototype,"visible",[z.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),o=C(r.prototype,"dirty",[z.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),l=C(r.prototype,"historyPos",[z.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),s=C(r.prototype,"historyEnd",[z.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c=C(r.prototype,"activeTileIndex",[z.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C(r.prototype,"toggleVisible",[z.action],Object.getOwnPropertyDescriptor(r.prototype,"toggleVisible"),r.prototype),C(r.prototype,"updateHistory",[z.action],Object.getOwnPropertyDescriptor(r.prototype,"updateHistory"),r.prototype),C(r.prototype,"selectTile",[i],Object.getOwnPropertyDescriptor(r.prototype,"selectTile"),r.prototype),C(r.prototype,"setDirty",[z.action],Object.getOwnPropertyDescriptor(r.prototype,"setDirty"),r.prototype),r),I=(n(38),n(31));function N(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var M=new y.i("#fff"),D=new y.i("#ff3c78");var R=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.grid=n,this.editorState=i,this.raycaster=new y.fb,this.material=0,this.current=null,this.object=function(){var e=new y.x({color:0,linewidth:1.5,depthTest:!1,opacity:.5,transparent:!0}),t=[];t.push(new y.wb(-.5,0,-.5)),t.push(new y.wb(.5,0,-.5)),t.push(new y.wb(.5,0,.5)),t.push(new y.wb(-.5,0,.5)),t.push(new y.wb(-.5,0,-.5));var n=new y.w((new I.a).setFromPoints(t),e),i=new y.J(new y.W(1,1),new y.K({color:16777215,depthTest:!1,opacity:.2,transparent:!0}));i.rotation.x=-h.j/4;var r=new y.q;return r.add(i),r.add(n),r}(),this.valid=!1,t.add(this.object)}var t,n,i;return t=e,(n=[{key:"setValid",value:function(e){this.valid=!!e,this.object.children[0].material.color=e?M:D,this.object.children[0].material.opacity=e?.2:.8}},{key:"update",value:function(e,t){var n=this.grid,i=this.raycaster,r=this.object,a=this.editorState;i.setFromCamera(e,t);var o=i.intersectObjects(n.group.children);if(o.length>0){this.current!==o[0].object&&(this.current=o[0].object,this.material=+this.current.name.substr(1));var l=o[0].point,s=a.activeTile,c=s.sizeX,u=(s.sizeY,s.sizeZ),f=2*this.material,m=n.offsets[f],d=n.offsets[f+1],p=Math.floor((l.x-m)/w.a)+n.size/2,v=Math.floor((l.z-d)/w.a)+n.size/2,y=p+c<=n.size&&v+u<=n.size;this.setValid(y);var b=m+(p-n.size/2)*w.a+c/2,h=d+(v-n.size/2)*w.a+u/2;r.position.x===b&&r.position.z===h||(this.x=p,this.y=v,r.position.set(b,0,h)),this.object.visible=!0}else this.object.visible=!1,this.valid=!1,this.current=null}}])&&N(t.prototype,n),i&&N(t,i),e}(),H=n(11),X=n(14),F=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/plain",i=document.createElement("a");i.setAttribute("href","data:"+n+";charset=utf-8,"+encodeURIComponent(t)),i.setAttribute("download",e),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)},U=n(12),Y=n(6);function Z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function J(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(i=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return n}(e,t)||L(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=L(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r,a=!0,o=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return a=e.done,e},e:function(e){o=!0,r=e},f:function(){try{a||null==i.return||i.return()}finally{if(o)throw r}}}}function V(e){return function(e){if(Array.isArray(e))return W(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||L(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){if(e){if("string"==typeof e)return W(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?W(e,t):void 0}}function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var K,q,G,$,Q,ee,te,ne,ie,re,ae,oe,le=2*Math.PI,se=new Set,ce=1e3,ue=.1,fe=.1;function me(){return window.innerWidth-(Ie.visible?220:0)}function de(e){e.preventDefault(),pe.x=e.clientX/me()*2-1,pe.y=-e.clientY/window.innerHeight*2+1}var pe=new y.vb(100,0);function ve(){G.aspect=me()/window.innerHeight,G.updateProjectionMatrix(),Q.setSize(me(),window.innerHeight)}function ye(){ie.update(pe,G),Ae&&(Ae.rotation.y=le*Ne/4,Ae.position.copy(ie.object.position)),function(){performance.now();Q.render($,G)}(),te&&te.update(),f()(ye)}var be=[];function he(e){var t=e.timestamp;"string"==typeof t&&(e.timestamp=new Date(t))}function we(){var e=function(){var e=localStorage.getItem("@fforw/islands:data");if(!e)return null;var t=JSON.parse(e);return he(t),t}();return!e||e.timestamp.getTime()<X.timestamp.getTime()?(console.info("Loading input JSON"),e=X):console.info("Loading from localStorage"),Object(U.a)(e,be,q,se,$)}function ge(){return JSON.stringify({version:1,timestamp:(new Date).toISOString(),instances:V(se).map((function(e){return{name:e.tile.name,position:[e.position.x,e.position.y,e.position.z],material:e.material,x:e.x,y:e.y}}))},null,4)}he(X);var xe,je=[];function Oe(){Ie.setDirty(!0),xe&&(clearTimeout(xe),xe=null),xe=setTimeout(_e,1e3)}function _e(){xe=null,Ie.setDirty(!1),localStorage.setItem("@fforw/islands:data",ge())}function Ee(e){var t=Ie.activeTile;if(ie.valid){var n=0!==t.id?new H.a($,t,Ae.position,Ne,ie.material,ie.x,ie.y):null,i=[],r=q.setTile(ie.material,ie.x,ie.y,t,Ne,(function(e){var t,n=B(se);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.indexes.indexOf(e)>=0){q.clearTile(r),r.removeObject(),i.push(r),se.delete(r);break}}}catch(e){n.e(e)}finally{n.f()}}));n&&(n.indexes=r,se.add(n)),Te(n,i),Oe()}}function Te(e,t){var n={added:e,removed:t},i=Ie.historyPos,r=Ie.historyEnd;if(Ie.historyPos<32)je[i++]=n,r=i,Ie.updateHistory(i,r);else{for(var a=0;a<i;a++)je[a]=je[a+1];je[i]=n}}function Pe(){return Ie.historyPos<Ie.historyEnd}function ze(){return Ie.historyPos>0}function ke(){var e=Ie.historyPos;if(Pe()){var t=je[e++],n=t.added,i=t.removed;if(n&&(q.setTile(n.material,n.x,n.y,n.tile,n.rotation,!0),n.createObject(),se.add(n)),i)for(var r=0;r<i.length;r++){var a=i[r];q.clearTile(a),a.removeObject(),se.delete(a)}Oe(),Ie.updateHistory(e)}}function Se(){if(ze()){var e=Ie.historyPos,t=je[--e],n=t.added,i=t.removed;if(n&&(q.clearTile(n),n.removeObject(),se.delete(n)),i)for(var r=0;r<i.length;r++){var a=i[r];q.setTile(a.material,a.x,a.y,a.tile,a.rotation,!0),a.createObject(),se.add(a)}Oe(),Ie.updateHistory(e)}}function Ce(e){var t=e.keyCode;82===t?Ne=Ne+(e.shiftKey?1:-1)&3:90===t&&e.ctrlKey&&(e.shiftKey?ke():Se())}Promise.all([Object(b.a)("assets/ground.glb"),Object(b.a)("assets/tiles.glb").then(Y.a)]).then((function(e){var t=J(e,2),n=t[0],i=t[1];be.push.apply(be,V(i)),console.log({tiles:be}),ne=h.f.map((function(e){var t=n.scene.children.find((function(t){return t.name===e}));if(!t)throw new Error("Could not find "+e);return t.material})),document.title+=" Rule Editor",K=document.getElementById("container"),(Q=new y.Ab).setPixelRatio(window.devicePixelRatio),Q.setSize(me(),window.innerHeight),Q.outputEncoding=y.Bb,K.appendChild(Q.domElement),(re=document.createElement("div")).setAttribute("id","root"),K.appendChild(re),$=new y.hb,(G=new y.U(55,me()/window.innerHeight,1,2e4)).up.set(0,1,0);G.position.set(-35,35,0),G.lookAt(new y.wb(0,0,0)),G.updateProjectionMatrix(),ee=new y.k("#fff8d5",1.4),$.add(ee),ae=new y.j(.2,1,512),$.background=ae.renderTarget;(oe=new x.a).material.uniforms;ae.renderTarget.texture,function(){if(oe){var e=Math.PI*(ue-.5),t=2*Math.PI*(fe-.5);ee.position.x=ce*Math.cos(t),ee.position.y=ce*Math.sin(t)*Math.sin(e),ee.position.z=ce*Math.sin(t)*Math.cos(e),oe.material.uniforms.sunPosition.value=ee.position.copy(ee.position),ae.update(Q,oe)}}(),(te=new g.a(G,Q.domElement)).maxPolarAngle=Math.PI,te.target.set(0,0,0),te.minDistance=0,te.maxDistance=1500,te.enableDamping=!0,te.dampingFactor=.02,te.mouseButtons={MIDDLE:y.F.ROTATE,RIGHT:y.F.PAN},te.update(),q=new w.b(12,$,ne),(ie=new R($,q,Ie)).update(pe,G),document.addEventListener("mousemove",de,!1),document.addEventListener("keydown",Ce,!1),window.addEventListener("resize",ve,!1),K.addEventListener("click",Ee,!1),we(),Ie.selectTile(1),new Promise((function(e,t){try{v.a.render(d.a.createElement(P,{editorState:Ie,clearAll:Me,download:function(){F("input.json",ge(),"text/json")},undo:Se,canUndo:ze,redo:ke,canRedo:Pe}),re,e)}catch(e){t(e)}})).then(ye)})),Object(z.configure)({enforceActions:"observed"});var Ae,Ie=new A(be);Object(z.reaction)((function(){return Ie.visible}),ve);var Ne=0;function Me(){var e,t=B(se);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.removeObject(),q.clearTile(n)}}catch(e){t.e(e)}finally{t.f()}Te(null,V(se)),se.clear(),Oe()}Object(z.reaction)((function(){return Ie.activeTileIndex}),(function(){var e=Ie.activeTile,t=Ie.activeTileIndex;ie.object.scale.set(e.sizeX,e.sizeY,e.sizeZ),Ae&&(!function e(t){t.material&&t.material.dispose();var n=t.children;if(n)for(var i=0;i<n.length;i++)e(n[i])}(Ae),$.remove(Ae)),0===t?Ae=null:((Ae=be[t].variants[0].clone()).scale.set(w.a,w.a,w.a),function e(t,n){t.material&&(t.material=t.material.clone(),t.material.transparent=n<1,t.material.opacity=n);var i=t.children;if(i)for(var r=0;r<i.length;r++)e(i[r],n)}(Ae,.2),Ae.rotation.y=le*Ne/4,console.log({ghost:Ae}),$.add(Ae)),console.log("ACTIVE",e)}));var De=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.KEY="@fforw/islands:data",this.download=F}var t,n,i;return t=e,(n=[{key:"grid",get:function(){return q}}])&&Z(t.prototype,n),i&&Z(t,i),e}();t.default=new De},6:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return m}));n(0);var i={cactus:{variants:["cactus_short","cactus_tall"],colors:["#0c0"]},flower:{variants:["flower_purpleA","flower_purpleB","flower_purpleC","flower_redA","flower_redB","flower_redC","flower_yellowA","flower_yellowB","flower_yellowC"],colors:["#ff0"]},stone_large:{variants:["stone_largeD","stone_largeE","stone_largeF"],colors:["#eee"]},stone_small:{variants:["stone_smallD"],colors:["#888"]},palm_tree:{variants:["tree_palmDetailedTall","tree_palmShort","tree_palmTall"],colors:["#8c0"]},pine:{variants:["tree_pineRoundD","tree_pineTallC_detailed","tree_pineTallD"],colors:["#480"]},tree_plateau:{variants:["tree_plateau"],colors:["#482"]},tree_tall_dark:{variants:["tree_tall_dark"],colors:["#360"]},tree_thin:{variants:["tree_thin"],colors:["#684"]},house:{variants:["House"],sizeX:3,sizeY:2,sizeZ:3,reachable:!0,colors:["#f00"],idCount:1,pattern:[0,0,0,0,-1,0,0,0,0]}},r=n(10);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return e[e.length-1].id+e[e.length-1].idCount}function c(){var e=document.createElement("canvas");e.width=u,e.height=f;var t=e.getContext("2d");t.lineWidth=4,t.strokeStyle="rgba(255,64,64,0.5)",t.fillStyle="#fff";var n=.5*u,i=.5*f,r=.3*Math.min(i,n);return t.beginPath(),t.moveTo(-r+n,-r+i),t.lineTo(r+n,r+i),t.moveTo(r+n,-r+i),t.lineTo(-r+n,r+i),t.rect(0,0,u,f),t.stroke(),t.fillText("None",4,f-4),e}var u=40,f=u/.75;function m(e){var t=[],n=0;for(var a in i)i.hasOwnProperty(a)&&function(){var r=i[a],l=r.variants,s=r.sizeX,c=void 0===s?1:s,u=r.sizeY,f=void 0===u?1:u,m=r.sizeZ,d=void 0===m?1:m;t[n]=o(o({id:-1,name:a},r),{},{variants:e?e.scene.children.filter((function(e){return l.indexOf(e.name)>=0})):l,pattern:r.pattern?r.pattern.slice():null,idCount:r.idCount||1,sizeX:c,sizeY:f,sizeZ:d,reachable:r.reachable||!1,thumbnail:null}),n++}();t.sort((function(e,t){return e.name===t.name?0:e.name<t.name?-1:1}));var l=1;if(t.forEach((function(e){var t=e.name,n=e.idCount,i=e.pattern,r=e.sizeX,a=e.sizeZ;if(e.id=l,l+=n,e.pattern){if(!i||!Array.isArray(i))throw new Error("Tile '"+t+"': tiles with idCount > 1 must define a pattern");var o=r*a;if(i.length!==o)throw new Error("Tile '"+t+"': Pattern must be "+r+" x "+a+" = "+o+" elements long: "+i);for(var s=0;s<i.length;s++)i[s]<0&&(i[s]=-i[s]-1+e.id)}else e.pattern=[e.id]})),e){var s=[],m=[];return t.forEach((function(e,t){s[t]=e.name,m[t]=e.variants[0]})),Object(r.a)(m,u,f,s).then((function(e){return e.forEach((function(e,n){return t[n].thumbnail=e})),t.unshift({id:0,name:"empty",variants:[],idCount:1,sizeX:1,sizeY:.1,sizeZ:1,thumbnail:c(),pattern:[0]}),t}))}return t.unshift({id:0,name:"empty",variants:[],idCount:1,sizeX:1,sizeY:.1,sizeZ:1,reachable:!1,colors:["#000"],thumbnail:null}),t}},7:function(e,t,n){"use strict";var i=new(n(15).a);t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,r){i.load(e,n,t,r)}))}},8:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return s}));var i,r=n(4),a=n(12),o=(n(2),n(6));function l(e,t){for(var n=0;n<e.length;n++){var i=e[n],r=i.name,a=i.id,o=i.idCount;if(t===a)return r;if(t>a&&t<a+o)return r+"-"+(t-a+1)}return"ERR:"+t}function s(e,t,n,l){var s=Object(o.b)(n),c=s+31>>5;(!i||i.length<c)&&(i=new Uint32Array(c));var u=new r.b(t);Object(a.a)(e,n,u);for(var f=0,m=t-1,d=function(e,t,n,i){var r=i>>5,a=1<<i-(r<<5),o=t*p*c+n*c+r,l=e[o],s=l|a;l!==s&&(e[o]=s)},p=s+1,v=r.c*p,y=new Uint32Array(v),b=r.c*p*c,h=new Uint32Array(b),w=0;w<r.c;w++)for(var g=0;g<t;g++)for(var x=0;x<t;x++){var j=u.data[f];0!==j&&y[w*p+1+j]++;var O=0===g?0:u.data[f-t],_=x===m?0:u.data[f+1],E=g===m?0:u.data[f+t],T=0===x?0:u.data[f-1];d(h,w,j,O),d(h,w,j,_),d(h,w,j,E),d(h,w,j,T),f++}f=0;for(var P=0;P<r.c;P++){i.fill(0);for(var z=0,k=0;k<s;k++){var S=y[f+1+k];if(S>0||0===k){z+=S;var C=k>>5,A=1<<k-(C<<5);i[C]|=A}}var I=P*p*c+s*c;if(0===z)y[f+1]=1,y[f]=1,i[0]|=1;else{var N=z*(l[P]/(1-l[P]));y[f+1]=N,y[f]=z+N}h.set(i,I),f+=p}return{weights:y,adjacencies:h}}},9:function(e,t,n){}}).default;
//# sourceMappingURL=bundle-editor-ddabbef8fc94d75b1446.js.map